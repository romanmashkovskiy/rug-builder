"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _loadMaps(e,t){void 0!==t&&("object"===_typeof(t.nmap)&&Object.keys(t.nmap).forEach(function(r){var a=t.nmap[r].full_url;(new THREE.TextureLoader).load(a,function(t){e.normalMap=t,e.needsUpdate=!0})}),"object"===_typeof(t.bmap)&&Object.keys(t.bmap).forEach(function(r){var a=t.bmap[r].full_url;(new THREE.TextureLoader).load(a,function(t){e.bumpMap=t,e.needsUpdate=!0})}),"object"===_typeof(t.dmap)&&Object.keys(t.dmap).forEach(function(r){var a=t.dmap[r].full_url;(new THREE.TextureLoader).load(a,function(t){e.displacementMap=t,e.needsUpdate=!0})}))}function _loadFiles(e,t,r,a){return new Promise(function(n,i){function o(e){return function(r){var n=new THREE.MeshLambertMaterial({color:14540253}),i=new THREE.Mesh(r,n),o=window.innerHeight;o<1e3&&o>850?(i.scale.x=.8,i.scale.y=.8,i.scale.z=.8):o<850&&o>700?(i.scale.x=.65,i.scale.y=.65,i.scale.z=.65):o<700&&(i.scale.x=.5,i.scale.y=.5,i.scale.z=.5),i.name=e,s.push(i),t.json[a][e]=i}}for(var s=[],c=0;c<e.length;c++)if(void 0===t.json[a][e[c]]){var l=templateDirectoryUri+"/rugbuilder/json/"+r+"/"+e[c]+".json",d=e[c];(new THREE.BufferGeometryLoader).load(l,o(d))}else s.push(t.json[a][e[c]]);var u=0,h=setInterval(function(){return 100===u?void i():(e.length===s.length&&(n(),clearInterval(h)),void u++)},100)})}function _updateScene(e,t){return new Promise(function(r,a){for(var n=e.scene.children.length,i=void 0,o=0;o<n;o++)if("Mesh"===e.scene.children[o].type){i=o;break}for(var s=0;s<n;s++)e.scene.remove(e.scene.children[i]);Object.keys(e.json[t]).forEach(function(r){e.scene.add(e.json[t][r]),void 0!==e.centerMaterial&&"center"===r&&(e.scene.children[e.scene.children.length-1].material=e.loadedTextures[e.centerMaterial])}),PubSub.publish("borderUpdate",t),e.loadingScreens("full","close"),r()})}function _createMaterialHTML(e,t,r){if(1!==e.state.stage){var a=e.state._materials;return"materials"===e.state.content?a.map(function(r,a){return React.createElement(t,{key:a,index:a,material:r.name,thumb:r.thumb,currentStage:e.state.stage,updateContent:e.updateContentState,updateMaterial:e.updateMaterialChoice})}):void 0}}function _createSidebarHTML(e,t,r,a){if(1!==e.state.stage){var n=e.state._materials;return"collections"===e.state.content&&"collections"===r?n.map(function(r,a){return React.createElement(t,{key:a,material:r.name,thumb:r.thumb,onUpdate:e.updateMaterialChoice})}):"swatches"===e.state.content&&"swatches"===r?n.map(function(r,a){return React.createElement(t,{key:a,material:r.name,thumb:r.thumb,updateContent:e.updateContentState,onUpdate:e.updateMaterialChoice})}):"swatchesSelected"===e.state.content&&"swatches--selected"===r?n.map(function(r,a){if(r.name===e.state.chosenMaterial)return React.createElement(t,{key:a,material:e.state.chosenMaterial,thumb:r.thumb,updateContent:e.updateContentState,onUpdate:e.updateMaterialChoice})}):void 0}}function _createCollectionsHTML(e,t,r){if(1!==e.state.stage&&4!==e.state.stage){var a=e.state._collections,n=a[e.state.chosenMaterial];return"collections"===e.state.content?n.map(function(r,a){return React.createElement(t,{key:a,collection:r.name,updateContent:e.updateContentState,onUpdate:e.updateCollectionChoice})}):void 0}}function _createSwatchesHTML(e,t,r,a){if(1!==e.state.stage){var n=e.state._swatches,i=n[e.state.chosenCollection];if("swatches"===e.state.content&&"swatches"===r&&void 0!==i)return Object.keys(i).map(function(r,a){var n=i[r],o=n.id,s=n.name,c=n.code,l=n.thumb,d={};return""!==n.bmap&&(d.bmap=n.bmap),""!==n.nmap&&(d.nmap=n.nmap),""!==n.dmap&&(d.dmap=n.dmap),React.createElement(t,{key:a,id:o,swatch:s,thumb:l,code:c,maps:d,updateContent:e.updateContentState,onUpdate:e.updateSwatchChoice})});if("swatchesSelected"===e.state.content&&"swatches--selected"===r){var o=function(){var r=e.state.chosenSwatch.replace(/ /g,""),a=e.state._swatches[e.state.chosenCollection],n=[],i=void 0,o=0;Object.keys(a).forEach(function(e){e===r&&(i=o),n[o]=a[e],o++});var s=[];if(i<=1){for(var c=0;c<i;c++)void 0!==n[c]&&s.push(n[c]);s.push(n[i]);for(var l=i+1;l<5;l++)void 0!==n[l]&&s.push(n[l])}else if(i>n.length-2){for(var d=i===n.length?2:1,u=2+d,h=i-u;h<i;h++)void 0!==n[h]&&s.push(n[h]);s.push(n[i]);for(var p=5-s.length,m=1+p,g=i+1;g<m;g++)void 0!==n[g]&&s.push(n[g])}else for(var v=i-2;v<i+3;v++)void 0!==n[v]&&s.push(n[v]);return{v:s.map(function(r,a){return React.createElement(t,{key:a,swatch:r.name,thumb:r.thumb,selected:e.state.chosenSwatch,updateContent:e.updateContentState,onUpdate:e.updateSwatchChoice})})}}();if("object"===("undefined"==typeof o?"undefined":_typeof(o)))return o.v}}}function _createBorderHTML(e,t,r){if(1===e.state.stage&&"border"===e.state.content){var a=e.state._borders;return a.map(function(r,a){return React.createElement(t,{key:a,border:r,onUpdate:e.updateBorderChoice})})}}function _createSizeHTML(e,t){if(4===e.state.stage)return React.createElement("span",null,React.createElement("input",{type:"number",onChange:e.handleSizeInputChange,value:e.state.length,name:"length",placeholder:"Enter Length (m)"}),React.createElement("input",{type:"number",onChange:e.handleSizeInputChange,value:e.state.width,name:"width",placeholder:"Enter Width (m)"}))}function _createPriceHTML(e,t){if(4===e.state.stage&&e.state.price)return React.createElement("h3",{className:"drawer-price"},"Price: £",e.state.price)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),RugBuilder=function(){function e(t){_classCallCheck(this,e),this.context=t,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.currentStage=0,this.stages=["center","borderType","innerBorder","outerBorder","size"],this.stageVisited=[!0,!1,!1,!1,!1],this.WCmaterials=[],this.WCcollections=[],this.WCswatches={},this.WCborderMaterials=[],this.WCBorderCollections={},this.WCborderSwatches={},this.scene=void 0,this.renderer=void 0,this.camera=void 0,this.cameraOptions={aspectRatio:this.screenWidth/this.screenHeight,far:1e3,near:.1,viewAngle:90},this.helpers={axis:void 0,grid:void 0,spotLight:void 0},this.lights={},this.orbitControls=void 0,this.json={single:{"border-east":void 0,"border-north":void 0,"border-south":void 0,"border-west":void 0,center:void 0,stitches:void 0},double:{"border-inner-east":void 0,"border-inner-north":void 0,"border-inner-south":void 0,"border-inner-west":void 0,"border-outer-east":void 0,"border-outer-north":void 0,"border-outer-south":void 0,"border-outer-west":void 0,center:void 0,stitches:void 0},piping:{center:void 0,"border-east":void 0,"border-north":void 0,"border-south":void 0,"border-west":void 0,stitches:void 0,"trim-east":void 0,"trim-north":void 0,"trim-south":void 0,"trim-west":void 0}},this.loadedTextures={},this.borderType=void 0,this.centerMaterial=void 0,this.borderMaterials={single:void 0,piping:void 0,double:{inner:void 0,outer:void 0}},this.centerID=0,this.singleBorderID=0,this.innerBorderID=0,this.outerBorderID=0,this.length=0,this.width=0,this.price=0,this.errors={100:"Material Loading Stage",101:"Collection Loading Stage",102:"Swatch Loading Stage",103:"Border Material Loading Stage",200:"Loading Single Border Into Three",201:"Loading Single & Piping Border Into Three",202:"Loading Double Border Into Three"}}return _createClass(e,[{key:"nextStage",value:function(){var e=this.currentStage+1;if(e>4)throw new Error("Cannot go higher than stage 4");this.stageVisited[e]||(this.stageVisited[e]=!0),this.currentStage=e,PubSub.publish("stageChange",e)}},{key:"prevStage",value:function(){var e=this.currentStage-1;if(e<0)throw new Error("Cannot go lower than stage 0");this.currentStage=e,PubSub.publish("stageChange",e)}},{key:"updateStage",value:function(e){if(e<0||e>4)throw new Error("Stage must not be less than 0 or greater than 4");var t=!1;this.currentStage+1===e?t=!0:this.stageVisited[e]?t=!0:this.stageVisited[e-1]?t=!0:"single"!==this.borderType&&"piping"!==this.borderType||2!==this.currentStage||4!==e||(t=!0),t&&(this.currentStage=e,PubSub.publish("stageChange",e))}},{key:"changeView",value:function(e){return 0===e?(this.camera.position.x=-40,this.camera.position.y=170,this.camera.position.z=0,this.camera.rotation.x=-1.5708,this.camera.rotation.y=0,this.camera.rotation.z=1.5708,1):1===e?(this.camera.position.x=70,this.camera.position.y=97.86732004062627,this.camera.position.z=108.5265830159921,this.camera.rotation.x=-.7337987907741792,this.camera.rotation.y=.47612198934967903,this.camera.rotation.z=.3919353811096299,2):2===e?(this.camera.position.x=-65,this.camera.position.y=146.97868270469004,this.camera.position.z=.00630814379798243,this.camera.rotation.x=-1.5707534317349763,this.camera.rotation.y=-.5996570925812806,this.camera.rotation.z=-1.5707203029033585,3):3===e?(this.camera.position.x=0,this.camera.position.y=170,this.camera.position.z=-55,this.camera.rotation.x=-1.5708,this.camera.rotation.y=0,this.camera.rotation.z=0,0):void 0}},{key:"zoomIn",value:function(e,t){var r=t+1;if(r>6)return!1;if(0===e||1===e){var a=this.camera.position.y,n=a-30;this.camera.position.y=n}else if(2===e){var i=this.camera.position.x,o=this.camera.position.y,s=this.camera.position.z,c=i-15,l=o-15,d=s-15;this.camera.position.x=c,this.camera.position.y=l,this.camera.position.z=d}else if(3===e){var u=this.camera.position.x,h=this.camera.position.y,p=u+15,m=h-15;this.camera.position.x=p,this.camera.position.y=m}return r}},{key:"zoomOut",value:function(e,t){var r=t-1;if(r<0)return!1;if(0===e||1===e){var a=this.camera.position.y,n=a+30;this.camera.position.y=n}else if(2===e){var i=this.camera.position.x,o=this.camera.position.y,s=this.camera.position.z,c=i+15,l=o+15,d=s+15;this.camera.position.x=c,this.camera.position.y=l,this.camera.position.z=d}else if(3===e){var u=this.camera.position.x,h=this.camera.position.y,p=u-15,m=h+15;this.camera.position.x=p,this.camera.position.y=m}return r}},{key:"startAgain",value:function(){this.currentStage=0,this.stageVisited=[!0,!1,!1,!1,!1],this.json={single:{borderEast:void 0,borderNorth:void 0,borderSouth:void 0,borderWest:void 0,center:void 0,stitches:void 0},double:{center:void 0,innerBorderEast:void 0,innerBorderNorth:void 0,innerBorderSouth:void 0,innerBorderWest:void 0,outerBorderEast:void 0,outerBorderNorth:void 0,outerBorderSouth:void 0,outerBorderWest:void 0,stitches:void 0},piping:{center:void 0,innerBorderEast:void 0,innerBorderNorth:void 0,innerBorderSouth:void 0,innerBorderWest:void 0,outerBorderEast:void 0,outerBorderNorth:void 0,outerBorderSouth:void 0,outerBorderWest:void 0,stitches:void 0}},this.centerMaterial=void 0,this.loadedTextures={},this.materialChoice={single:{border:void 0,center:void 0,stitches:void 0},double:{center:void 0,innerBorder:void 0,outerBorder:void 0,stitches:void 0},piping:{center:void 0,innerBorder:void 0,outerBorder:void 0,stitches:void 0}},PubSub.publish("stageChange",0)}},{key:"calculatePrice",value:function(e,t){var r=this,a=void 0;if(0===e||""===e||0===t||""===t)return void PubSub.publish("newPrice",0);var n=this.centerMaterial;+this.getPriceData(n).then(function(n){var i=e*t,o=n*i,s=r.borderType;if("single"===s||"piping"===s){var c=r.borderMaterials[s];r.getPriceData(c).then(function(n){a=o+n,PubSub.publish("newPrice",a),r.length=e,r.width=t,r.price=a}).catch(function(){R.error(1e3,!0)})}else"double"===s&&!function(){var n=r.borderMaterials.double.inner,i=r.borderMaterials.double.outer;r.getPriceData(n).then(function(e){return r.getPriceData(i)}).then(function(n){a=o+price2+n,PubSub.publish("newPrice",a),r.length=e,r.width=t,r.price=a}).catch(function(){R.error(1e3,!0)})}()}).catch(function(){R.error(1e3,!0)})}}]),e}();RugBuilder.prototype.start=function(){function e(){function e(){function e(){requestAnimationFrame(e),r.renderer.render(r.scene,r.camera)}function t(){r.screenWidth=window.innerWidth,r.screenHeight=window.innerHeight,r.cameraOptions.aspectRatio=r.screenWidth/r.screenHeight,r.camera.aspect=r.cameraOptions.aspectRatio,r.camera.updateProjectionMatrix(),r.renderer.setSize(r.screenWidth,r.screenHeight),r.screenHeight>1e3?(r.camera.position.z=-55,Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=1,r.json[e][t].scale.y=1,r.json[e][t].scale.z=1)})})):r.screenHeight<1e3&&r.screenHeight>850?(r.camera.position.z=-62,Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=.8,r.json[e][t].scale.y=.8,r.json[e][t].scale.z=.8)})})):r.screenHeight<850&&r.screenHeight>700?(r.camera.position.z=-70,Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=.65,r.json[e][t].scale.y=.65,r.json[e][t].scale.z=.65)})})):r.screenHeight<700&&(r.camera.position.z=-90,Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=.5,r.json[e][t].scale.y=.5,r.json[e][t].scale.z=.5)})}))}r.initOrbit(),r.camera.position.x=0,r.camera.position.y=170;var a=window.innerHeight;a>1e3?r.camera.position.z=-55:a<1e3&&a>850?r.camera.position.z=-62:a<850&&a>700?r.camera.position.z=-70:a<700&&(r.camera.position.z=-90),r.camera.rotation.x=-1.5708,r.camera.rotation.z=0,r.camera.rotation.z=0,e(),r.loadingScreens("full","close"),window.addEventListener("resize",t,!1)}var t=r.btnExitComponent(),a=r.btnRestartComponent(),n=r.btnStageComponent();r.menuComponent(t,a,n);var i=r.btnExpandCollapseComponent(),o=r.btnMaterialComponent(),s=r.btnCollectionComponent(),c=r.btnSwatchComponent(),l=r.btnBorderComponent(),d=r.sideMenuComponent();r.drawerComponent(i,o,s,c,d,l),r.priceComponent(),r.viewControls(),r.initThree(),r.initLights(),r.initScene(),r.updateBorder("Single & Piping").then(function(){e()})}function t(e){var t=100+e;r.error(t,!0)}var r=rugBuilder;r.getMaterialsData().then(function(){return r.getCollectionsData()}).then(function(){e()}).catch(function(e){t(e)})},RugBuilder.prototype.getMaterialsData=function(e){return new Promise(function(t,r){var a=rugBuilder,n=a.context;!function(){switch(n){case"website":var i=function(){200!==this.status&&r(0),"border"===e?(a.WCborderMaterials=JSON.parse(this.response),a.loadingScreens("full","close")):a.WCmaterials=JSON.parse(this.response),t(!0)},o=function t(){var r=new XMLHttpRequest,n=window.location.href;"#"===n[n.length-1]&&(n=n.substr(0,n.length-1));var t="materials";"border"===e&&(a.loadingScreens("full","open"),t="border"),r.addEventListener("load",i),r.open("GET",n+"?request="+t),r.send()};o()}}()})},RugBuilder.prototype.getCollectionsData=function(e){return new Promise(function(t,r){var a=rugBuilder,n=a.context;!function(){switch(n){case"website":var i=function(){200!==this.status&&r(1),e?a.WCBorderCollections[e]=JSON.parse(this.response):a.WCcollections=JSON.parse(this.response),t(JSON.parse(this.response))},o=function(){var t=new XMLHttpRequest,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1));var a=r+"?request=collections";e&&(a+="&collection="+e),t.addEventListener("load",i),t.open("GET",a),t.send()};o()}}()})},RugBuilder.prototype.getSwatchData=function(e){return new Promise(function(t,r){var a=rugBuilder,n=a.context;!function(){switch(n){case"website":var i=function(){200!==this.status&&r(0),a.WCswatches=JSON.parse(this.response),t(JSON.parse(this.response))},o=function(){var t=new XMLHttpRequest,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1));var a=e.toLowerCase();t.addEventListener("load",i),t.open("GET",r+"?request=swatches&collection="+a),t.send()};o()}}()})},RugBuilder.prototype.getPriceData=function(e){return new Promise(function(t,r){var a=rugBuilder,n=a.context;switch(n){case"website":var i=function(){return 200!=this.status?void r():void t(JSON.parse(this.response))},o=new XMLHttpRequest,s=window.location.href;"#"===s[s.length-1]&&(s=s.substr(0,s.length-1));var c=s+"?request=price&material="+encodeURIComponent(e);o.addEventListener("load",i),o.open("GET",c),o.send()}})},RugBuilder.prototype.initThree=function(){var e=rugBuilder,t=e.cameraOptions,r=new THREE.Scene,a=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),n=new THREE.PerspectiveCamera(t.viewAngle,t.aspectRatio,t.near,t.far);a.gammaInput=!0,a.gammaOutput=!0,a.setSize(window.innerWidth,window.innerHeight),a.setClearColor(15987699),e.scene=r,e.renderer=a,e.camera=n},RugBuilder.prototype.displayTexture=function(e,t,r,a){if(t.indexOf("-150x150")>-1&&(t=t.replace("-150x150","")),1!==r&&4!==r){var n=rugBuilder,i=n.borderType,o=void 0,s=void 0,c=void 0,l=void 0;switch(r){case 0:o="centerMaterial",l=["center"];break;case 2:"single"===i?(o="borderMaterials",s="single",l=["border-east","border-north","border-south","border-west"]):"piping"===i?(o="borderMaterials",s="piping",l=["border-east","border-north","border-south","border-west","trim-east","trim-north","trim-south","trim-west"]):(o="borderMaterials",s="double",c="inner",l=["border-inner-east","border-inner-north","border-inner-south","border-inner-west"]);break;case 3:o="borderMaterials",s="double",c="outer",l=["border-outer-east","border-outer-north","border-outer-south","border-outer-west"]}if(console.log(n.loadedTextures[e]),void 0===n.loadedTextures[e])(new THREE.TextureLoader).load(t,function(t){t.wrapS=t.wrapT=THREE.RepeatWrapping,t.anisotropy=n.renderer.getMaxAnisotropy(),0===r?t.repeat.set(7,7):2!==r&&3!==r||t.repeat.set(10,10);var i=new THREE.MeshPhongMaterial({map:t,color:16777215,shininess:5});n.loadedTextures[e]=i,void 0!==c?n[o][s][c]=e:void 0!==s?n[o][s]=e:n[o]=e;for(var d=0;d<n.scene.children.length;d++)l.indexOf(n.scene.children[d].name)>-1&&(n.scene.children[d].material=n.loadedTextures[e],_loadMaps(n.scene.children[d].material,a));n.loadingScreens("full","close")});else{void 0!==c?n[o][s][c]=e:void 0!==s?n[o][s]=e:n[o]=e;for(var d=0;d<n.scene.children.length;d++)l.indexOf(n.scene.children[d].name)>-1&&(n.scene.children[d].material=n.loadedTextures[e],_loadMaps(n.scene.children[d].material,a));n.loadingScreens("full","close")}}},RugBuilder.prototype.error=function(e,t){function r(){a.error(0,!1)}var a=rugBuilder;document.querySelector("#close-error").addEventListener("click",r);var n=document.querySelector("#error-box"),i=document.querySelector("#error-msg"),o=document.querySelector("#error-code");i.innerHTML="",o.innerHTML="";var s=void 0;switch(e){case 0:s="";break;case 100:case 101:s="Sorry, an error has occured loading the RugBuilder. Please refresh the page.";break;case 102:s="Sorry, an error has occured loading the swatches. Please refresh the page.";break;case 103:s="Sorry, an error has occured loading the borders. Please refresh the page.";break;case 200:case 201:case 202:s="Sorry, an error occured updating the border. Please try again.";case 1e3:s="Sorry, an error has occured. Please try again."}i.innerHTML=s,o.innerHTML="Error Code: "+e,t?n.style.display="block":n.style.display="none"},RugBuilder.prototype.loadingScreens=function(e,t){var r=void 0;switch(e){case"full":r="#full-loading";break;case"drawer":r="#drawer-loading";break;case"canvas":r="#canvas-loading"}var a="open"===t?99999:-99999;document.querySelector(r).style.zIndex=a},RugBuilder.prototype.updateBorder=function(e){var t=rugBuilder,r=[];return new Promise(function(a,n){switch(e){case"Single Border":r=["border-east","border-north","border-south","border-west","center","stitches"],t.borderType="single",_loadFiles(r,t,"single","single").then(function(){return _updateScene(t,"single")}).then(function(){a()}).catch(function(){t.error(200,!0)});break;case"Single & Piping":r=["border-east","border-north","border-south","border-west","center","stitches","trim-east","trim-north","trim-south","trim-west"],t.borderType="piping",_loadFiles(r,t,"single","piping").then(function(){return _updateScene(t,"piping")}).then(function(){a()}).catch(function(){t.error(201,!0)});break;case"Double Border":r=["border-inner-east","border-inner-north","border-inner-south","border-inner-west","border-outer-east","border-outer-north","border-outer-south","border-outer-west","center","stitches"],t.borderType="double",_loadFiles(r,t,"double","double").then(function(){return _updateScene(t,"double")}).then(function(){a()}).catch(function(){t.error(202,!0)})}})},RugBuilder.prototype.initLights=function(e){var t=rugBuilder,r=new THREE.SpotLight(16777215,1,0,.3141592653589793,0,1),a=new THREE.SpotLight(16777215,.7,0,.3141592653589793,0,1),n=new THREE.AmbientLight(16777215),i=new THREE.DirectionalLight(16777215);r.position.set(216.55,238.95,-217.97),a.position.set(307.15,157.37,-80.38),i.position.set(5,10,7.5),t.lights.spotLight=r,t.lights.spotLight2=a,t.lights.ambientLight=n,t.lights.directionalLight=i},RugBuilder.prototype.initScene=function(){var e=rugBuilder;e.scene.add(e.camera),e.scene.add(e.lights.spotLight),e.scene.add(e.lights.spotLight),e.scene.add(e.lights.directionalLight),document.body.appendChild(e.renderer.domElement)},RugBuilder.prototype.initOrbit=function(){var e=rugBuilder;e.orbitControls=new THREE.OrbitControls(e.camera,e.renderer.domElement),e.orbitControls.minDistance=50,e.orbitControls.maxDistance=300,e.orbitControls.maxPolarAngle=Math.PI/2-.1},RugBuilder.prototype.orderScreenComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"OrderScreenComponent",getInitialState:function(){this.centerID=0,this.singleBorderID=0,this.innerBorderID=0,this.outerBorderID=0;var t=e.centerMaterial,r=e.centerID,a=e.borderType,n=("single"===a||"piping"===a)&&e.borderMaterials[a],i=("single"===a||"piping"===a)&&e.singleBorderID,o="double"===a&&e.borderMaterials.double.inner,s="double"===a&&e.borderMaterials.double.outer,c="double"===a&&e.innerBorderID,l="double"===a&&e.outerBorderID,d=e.length,u=e.width,h=e.price,p=e.camera.position,m=e.camera.rotation,g={centerMaterial:t,centerID:r,borderType:a,singleBorderMaterial:n,innerBorderMaterial:o,outerBorderMaterial:s,singleBorderID:i,innerBorderID:c,outerBorderID:l,length:d,width:u,price:h,cameraPosition:p,cameraRotation:m};return g},edit:function(){e.camera.position.x=this.state.cameraPosition.x,e.camera.position.y=this.state.cameraPosition.y,e.camera.position.z=this.state.cameraPosition.z,e.camera.rotation.x=this.state.cameraRotation.x,e.camera.rotation.y=this.state.cameraRotation.y,e.camera.rotation.z=this.state.cameraRotation.z,e.updateStage(4),ReactDOM.unmountComponentAtNode(document.querySelector("#order-screen"))},print:function(){window.print()},order:function(){function e(){return 200!==this.status?void alert("error"):void alert("samples added to your basket")}var t=this.state.borderType,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1)),r+="?products=",r+=this.state.centerID+",","single"===t||"piping"===t?r+=this.state.singleBorderID:"double"===t&&(r+=this.state.innerBorderID+",",r+=this.state.outerBorderID);var a=new XMLHttpRequest;a.addEventListener("load",e),a.open("GET",r),a.send()},basket:function(){function e(){return 200!==this.status?void alert("error"):void alert("rug added to your basket")}var t=this.state.borderType,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1)),r+="?products=",r+=this.state.centerID+",","single"===t||"piping"===t?r+=this.state.singleBorderID:"double"===t&&(r+=this.state.innerBorderID+",",r+=this.state.outerBorderID),r+="&center="+this.state.centerID,r+="&length="+this.state.length,r+="&width="+this.state.width,r+="&price="+this.state.price;var a=new XMLHttpRequest;a.addEventListener("load",e),a.open("GET",r),a.send()},render:function(){var t={};t.Center=this.state.centerMaterial,"single"===this.state.borderType||"piping"===this.state.borderType?t.Border=this.state.singleBorderMaterial:"double"===this.state.borderType&&(t["Inner Border"]=this.state.innerBorderMaterial,t["Outer Border"]=this.state.outerBorderMaterial);var r=function(){return Object.keys(t).map(function(e,r){return React.createElement("div",{className:"details__row clearfix",key:r},React.createElement("p",null,t[e]),React.createElement("p",null,e))})},a=document.querySelector("canvas").toDataURL();return e.loadingScreens("full","close"),React.createElement("div",{className:"order"},React.createElement("h2",{className:"order__title"},"Order Rug"),React.createElement("span",{className:"order__underline"}),React.createElement("div",{className:"order__content clearfix"},React.createElement("div",{className:"order__image"},React.createElement("img",{src:a,alt:"Your Rug"})),React.createElement("div",{className:"order__details"},React.createElement("div",{className:"details__row header clearfix"},React.createElement("h3",null,"Material"),React.createElement("h3",null,"Section")),r(),React.createElement("div",{className:"details__row header sizing clearfix"},React.createElement("h3",null,"Sizing"),React.createElement("h3",null,"Price")),React.createElement("div",{className:"details__row clearfix"},React.createElement("p",null,this.state.length,"m x ",this.state.width,"m"),React.createElement("p",null,"£",this.state.price)))),React.createElement("div",{className:"order__links"},React.createElement("a",{href:"#",className:"link__edit",onClick:this.edit},"Edit Rug"),React.createElement("a",{href:"#",className:"link__print",onClick:this.print},"Print Details"),React.createElement("a",{href:"#",className:"link__order",onClick:this.order},"Order Samples"),React.createElement("a",{href:"#",className:"link__basket",onClick:this.basket},"Add to Basket")))}});ReactDOM.render(React.createElement(t,null),document.querySelector("#order-screen"))},RugBuilder.prototype.priceComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"PriceComponent",getInitialState:function(){return{price:0}},componentDidMount:function(){this.newPrice=PubSub.subscribe("newPrice",this.showNewPrice)},componentWillUnmount:function(){PubSub.unsubscribe(this.newPrice)},showNewPrice:function(e){return 0===e?void this.setState({price:!1}):void this.setState({price:e})},goToOrderScreen:function(){e.loadingScreens("full","open"),e.camera.position.y=120,e.camera.position.z=0,setTimeout(function(){e.orderScreenComponent()},10)},render:function(){var e=void 0;return e=this.state.price?React.createElement("span",null,React.createElement("h3",null,"£ ",this.state.price),React.createElement("a",{href:"#",onClick:this.goToOrderScreen},"Finish Building")):"",React.createElement("div",{className:"price__container"},e)}});ReactDOM.render(React.createElement(t,null),document.querySelector("#price"))},RugBuilder.prototype.viewControls=function(){var e=rugBuilder,t=React.createClass({displayName:"ViewControlsComponent",getInitialState:function(){return{view:0,zoom:1}},iconURLS:[templateDirectoryUri+"/rugbuilder/assets/icons/above-horizontal.svg",templateDirectoryUri+"/rugbuilder/assets/icons/angled.svg",templateDirectoryUri+"/rugbuilder/assets/icons/angled-horizontal.svg",templateDirectoryUri+"/rugbuilder/assets/icons/above-vertical.svg"],changeView:function(){var t=e.changeView(this.state.view);this.setState({view:t,zoom:1})},zoomIn:function(){var t=e.zoomIn(this.state.view,this.state.zoom);t&&this.setState({zoom:t})},zoomOut:function(){var t=e.zoomOut(this.state.view,this.state.zoom);t!==!1&&this.setState({zoom:t})},render:function(){var e=this.iconURLS[this.state.view],t=templateDirectoryUri+"/rugbuilder/assets/icons/zoom-in.svg",r=templateDirectoryUri+"/rugbuilder/assets/icons/zoom-out.svg",a="view"+this.state.view;return React.createElement("div",{className:"controls__container"},React.createElement("div",{className:"control"},React.createElement("a",{className:"control__link",onClick:this.changeView},React.createElement("img",{src:e,alt:"Change View",className:a}))),React.createElement("div",{className:"control"},React.createElement("a",{className:"control__link",onClick:this.zoomIn},React.createElement("img",{src:t,alt:"Zoom In",className:"zoom"}))),React.createElement("div",{className:"control"},React.createElement("a",{className:"control__link",onClick:this.zoomOut},React.createElement("img",{src:r,alt:"Zoom Out",className:"zoom"}))))}});ReactDOM.render(React.createElement(t,null),document.querySelector("#view-controls"))},RugBuilder.prototype.btnBorderComponent=function(){var e=React.createClass({displayName:"BtnBorderComponent",handleClick:function(){this.props.onUpdate(this.props.border)},render:function(){var e=void 0;switch(this.props.border){case"Single Border":e="http://d105txpzekqrfa.cloudfront.net/uploads/2016/11/11174349/single-border-icon.svg";break;case"Single & Piping":e="http://d105txpzekqrfa.cloudfront.net/uploads/2016/11/11174352/single-piping-icon.svg";break;case"Double Border":e="http://d105txpzekqrfa.cloudfront.net/uploads/2016/11/11174338/double-border-icon.svg"}return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:e,alt:this.props.border}),React.createElement("h3",null,this.props.border)))}});return e},RugBuilder.prototype.btnCollectionComponent=function(){var e=React.createClass({displayName:"BtnCollectionComponent",handleClick:function(){this.props.updateContent("swatches"),this.props.onUpdate(this.props.collection.replace(/ /g,"-"))},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("h3",null,this.props.collection)))}});return e},RugBuilder.prototype.btnExpandCollapseComponent=function(){var e=React.createClass({displayName:"BtnExpandCollapseComponent",handleClick:function(){this.props.currentState.open?this.props.onUpdate(!0):this.props.onUpdate(!1)},render:function(){return React.createElement("a",{href:"#",className:"expCol",onClick:this.handleClick},this.props.currentState.text)}});return e},RugBuilder.prototype.btnMaterialComponent=function(){var e=(rugBuilder,React.createClass({displayName:"BtnMaterialComponent",handleClick:function(){var e="collections";this.props.updateContent(e),this.props.updateMaterial(this.props.material)},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.material}),React.createElement("h3",null,this.props.material)))}}));return e},RugBuilder.prototype.btnSwatchComponent=function(){var e=React.createClass({displayName:"BtnSwatchComponent",handleClick:function(){this.props.updateContent("swatchesSelected"),this.props.onUpdate(this.props.swatch,this.props.thumb,this.props.id,this.props.maps)},render:function(){var e="";return this.props.selected===this.props.swatch&&(e="selected"),React.createElement("li",{className:e},React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.swatch}),React.createElement("h3",null,this.props.code)))}});return e},RugBuilder.prototype.drawerComponent=function(e,t,r,a,n,i){var o=rugBuilder,s=React.createClass({displayName:"DrawerComponent",getInitialState:function(){var e=o.WCmaterials,t=o.WCcollections;return{stage:o.currentStage,content:"materials",open:!0,text:"Collapse",chosenMaterial:void 0,chosenCollection:void 0,chosenSwatch:void 0,chosenBorder:"Single & Piping",_materials:e,_collections:t,_swatches:{},_borders:["Single Border","Single & Piping","Double Border"],length:"",width:"",price:!1}},componentDidMount:function(){this.stageChange=PubSub.subscribe("stageChange",this.updateStageState),this.newPrice=PubSub.subscribe("newPrice",this.showNewPrice)},componentWillUnmount:function(){PubSub.unsubscribe(this.stageChange),PubSub.unsubscribe(this.newPrice)},updateStageState:function(e){
this.setState({stage:e});var t=void 0;switch(e){case 0:t="materials",this.setState({_materials:o.WCmaterials,_collections:o.WCcollections,_swatches:{}});break;case 1:t="border";break;case 2:t="materials",0===o.WCborderMaterials.length?(this.setState({_materials:[],chosenMaterial:void 0,chosenCollection:void 0,chosenSwatch:void 0}),this.getBorderMaterials()):this.setState({_materials:o.WCborderMaterials});break;case 3:t="materials",this.setState({_materials:o.WCborderMaterials,chosenMaterial:void 0,chosenCollection:void 0,chosenSwatch:void 0});break;case 4:t="size"}this.updateContentState(t)},showNewPrice:function(e){return 0===e?void this.setState({price:!1}):void this.setState({price:e})},getBorderMaterials:function(){var e=this;o.getMaterialsData("border").then(function(t){e.setState({_materials:o.WCborderMaterials})}).catch(function(){o.error(103,!0)})},updateOpenState:function(e){var t=document.querySelector("#drawer");if(e){var r=t.offsetHeight;t.style.marginTop="-"+r+"px",this.setState({open:!1,text:"Expand"})}else t.style.marginTop=0,this.setState({open:!0,text:"Collapse"})},updateContentState:function(e){this.setState({content:e})},updateMaterialChoice:function(e){var t=this;this.setState({chosenMaterial:e,chosenCollection:void 0}),2!==this.state.stage&&3!==this.state.stage||o.getCollectionsData(e).then(function(r){t.state._collections[e]=r,t.forceUpdate()}).catch(function(){o.error(101,!0)})},updateCollectionChoice:function(e){var t=this;this.setState({chosenCollection:e}),o.loadingScreens("full","open"),o.getSwatchData(e).then(function(r){t.state._swatches[e]=r,o.loadingScreens("full","close"),t.forceUpdate()}).catch(function(){o.error(102,!0)})},updateSwatchChoice:function(e,t,r,a){this.setState({chosenSwatch:e}),o.loadingScreens("full","open"),0===this.state.stage?o.centerID=r:2!==this.state.stage||"Single Border"!==this.state.chosenBorder&&"Single & Piping"!==this.state.chosenBorder?2===this.state.stage&&"Double Border"===this.state.chosenBorder?o.innerBorderID=r:3===this.state.stage&&"Double Border"===this.state.chosenBorder&&(o.outerBorderID=r):o.singleBorderID=r,o.displayTexture(e,t,this.state.stage,a)},updateBorderChoice:function(e){this.setState({chosenBorder:e}),o.loadingScreens("full","open"),o.updateBorder(e)},handleSizeInputChange:function(e){var t=this;void 0!==e.target.value&&("length"===e.target.name?this.setState({length:e.target.value}):"width"===e.target.name&&this.setState({width:e.target.value}),(""!==this.state.length&&"width"===e.target.name||""!==this.state.width&&"length"===e.target.name)&&!function(){var e=t;setTimeout(function(){o.calculatePrice(e.state.length,e.state.width)},250)}())},createMaterialHTML:function(){return _createMaterialHTML(this,t,o)},createSidebarHTML:function(e){return _createSidebarHTML(this,n,e,o)},createCollectionsHTML:function(){return _createCollectionsHTML(this,r,o)},createSwatchesHTML:function(e){return _createSwatchesHTML(this,a,e,o)},createBorderHTML:function(){return _createBorderHTML(this,i,o)},createSizeHTML:function(){return _createSizeHTML(this,o)},createPriceHTML:function(){return _createPriceHTML(this,o)},render:function(){var t=this,r=t.createMaterialHTML(),a=function(e){return t.createSidebarHTML(e)},n=t.createCollectionsHTML(),i=function(e){return t.createSwatchesHTML(e)},o=t.createBorderHTML(),s=t.createSizeHTML(),c=t.createPriceHTML(),l=t.state.open?"open":"closed",d="drawer__content "+l+" "+this.state.content,u="drawer__content__material stage"+this.state.stage;return React.createElement("div",{className:"react-container drawer__container"},React.createElement("div",{className:d},React.createElement("div",{className:u},React.createElement("ul",null,r)),React.createElement("div",{className:"drawer__content__collections clearfix"},React.createElement("div",{className:"drawer__collections__sidebar"},React.createElement("ul",null,a("collections"))),React.createElement("div",{className:"drawer__collections__collections"},React.createElement("ul",{className:"clearfix"},n))),React.createElement("div",{className:"drawer__content__swatches clearfix"},React.createElement("div",{className:"drawer__swatches__sidebar"},React.createElement("ul",null,a("swatches"))),React.createElement("div",{className:"drawer__swatches__swatches"},React.createElement("ul",{className:"clearfix"},i("swatches")))),React.createElement("div",{className:"drawer__content__swatches--selected clearfix"},React.createElement("div",{className:"drawer__swatches--selected__sidebar"},React.createElement("ul",null,a("swatches--selected"))),React.createElement("div",{className:"drawer__swatches--selected__swatches"},React.createElement("ul",{className:"clearfix"},i("swatches--selected")))),React.createElement("div",{className:"drawer__content__border"},React.createElement("ul",null,o)),React.createElement("div",{className:"drawer__content__size"},s,c)),React.createElement(e,{onUpdate:this.updateOpenState,currentState:this.state}))}});ReactDOM.render(React.createElement(s,null),document.querySelector("#drawer"))},RugBuilder.prototype.sideMenuComponent=function(){var e=React.createClass({displayName:"SideMenuComponent",handleClick:function(){this.props.onUpdate(this.props.material),this.props.updateContent&&this.props.updateContent("collections")},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.material}),React.createElement("h3",null,this.props.material)))}});return e},RugBuilder.prototype.btnExitComponent=function(){var e=React.createClass({displayName:"BtnExitComponent",render:function(){var e=templateDirectoryUri+"/rugbuilder/assets/icons/exit.svg",t=window.location.href;return React.createElement("a",{href:t,className:"progress-menu__exit"},React.createElement("img",{src:e}),"Exit")}});return e},RugBuilder.prototype.btnRestartComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"BtnRestartComponent",restart:function(){e.updateStage(0),e.startAgain(),e.updateBorder("Single & Piping")},render:function(){var e=templateDirectoryUri+"/rugbuilder/assets/icons/restart.svg";return React.createElement("a",{href:"#",className:"progress-menu__restart",onClick:this.restart},React.createElement("img",{src:e}),"Start Again")}});return t},RugBuilder.prototype.btnStageComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"BtnStageComponent",handleClick:function(){var t=e.currentStage,r=this.props.index;return t===r?void e.updateStage(r):"single"!==e.borderType&&"piping"!==e.borderType||2!==t||3!==r?void(t+1===r?e.nextStage():t-1===r?e.prevStage():e.updateStage(r)):void e.updateStage(4)},render:function(){var t=e.currentStage,r="";this.props.index===t&&(r="active");var a="progress-menu__stage "+r;return React.createElement("li",{className:a},React.createElement("a",{href:"#",className:"progress-menu__stage__link",onClick:this.handleClick},this.props.stage))}});return t},RugBuilder.prototype.menuComponent=function(e,t,r){var a=(rugBuilder,React.createClass({displayName:"MenuComponent",getInitialState:function(){return{stages:["Center","Border Type","Border","Rug Size"]}},componentDidMount:function(){this.stageChange=PubSub.subscribe("stageChange",this.stageHasChanged),this.borderChange=PubSub.subscribe("borderUpdate",this.borderHasChanged)},componentWillUnmount:function(){PubSub.unsubscribe(this.stageChange),PubSub.unsubscribe(this.borderChange)},stageHasChanged:function(){this.forceUpdate()},borderHasChanged:function(e){"single"===e||"piping"===e?this.setState({stages:["Center","Border Type","Border","Rug Size"]}):"double"===e&&this.setState({stages:["Center","Border Type","Inner Border","Outer Border","Rug Size"]})},render:function(){var a=this.state.stages,n=a.map(function(e,t){return React.createElement(r,{stage:e,key:t,index:t})}),i=templateDirectoryUri+"/rugbuilder/assets/img/logo.png";return React.createElement("div",{className:"progress-menu__container"},React.createElement("div",{className:"progress-menu__top"},React.createElement("img",{src:i,alt:"Crucial Trading Rug Builder"}),React.createElement(t,null),React.createElement(e,null)),React.createElement("div",{className:"progress-menu__bottom"},React.createElement("ul",{className:"progress-menu__stages"},n)))}}));ReactDOM.render(React.createElement(a,null),document.querySelector("#progress-menu"))};
//# sourceMappingURL=maps/rugBuilder.min.js.map
