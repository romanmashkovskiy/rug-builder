"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),RugBuilder=function(){function e(t){_classCallCheck(this,e),this.context=t,this.materials=[],this.collections={},this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.currentStage=0,this.stages=["center","borderType","innerBorder","outerBorder","size"],this.stageVisited=[!0,!1,!1,!1,!1],this.renderer=void 0,this.scene=void 0,this.camera=void 0,this.cameraOptions={aspectRatio:this.screenWidth/this.screenHeight,far:1e3,near:.1,viewAngle:90},this.helpers={axis:void 0,grid:void 0,spotLight:void 0},this.lights={ambientLight:void 0,directionalLight:void 0,spotLight:void 0},this.center=void 0,this.json={single:{borderEast:void 0,borderNorth:void 0,borderSouth:void 0,borderWest:void 0,center:void 0,stitches:void 0},double:{center:void 0,innerBorderEast:void 0,innerBorderNorth:void 0,innerBorderSouth:void 0,innerBorderWest:void 0,outerBorderEast:void 0,outerBorderNorth:void 0,outerBorderSouth:void 0,outerBorderWest:void 0,stitches:void 0},piping:{center:void 0,innerBorderEast:void 0,innerBorderNorth:void 0,innerBorderSouth:void 0,innerBorderWest:void 0,outerBorderEast:void 0,outerBorderNorth:void 0,outerBorderSouth:void 0,outerBorderWest:void 0,stitches:void 0}},this.centerMaterial=void 0,this.loadedTextures={},this.materialChoice={single:{border:void 0,center:void 0,stitches:void 0},double:{center:void 0,innerBorder:void 0,outerBorder:void 0,stitches:void 0},piping:{center:void 0,innerBorder:void 0,outerBorder:void 0,stitches:void 0}},this.reactComponents={}}return _createClass(e,[{key:"nextStage",value:function(){var e=this.currentStage+1;if(e>4)throw new Error("Cannot go higher than stage 4");this.stageVisited[e]||(this.stageVisited[e]=!0),this.currentStage=e}},{key:"prevStage",value:function(){var e=this.currentStage-1;if(e<0)throw new Error("Cannot go lower than stage 0");this.currentStage=e}},{key:"updateStage",value:function(e){if(e<0||e>4)throw new Error("Stage must not be less than 0 or greater than 4");var t=!1;this.currentStage+1===e?t=!0:this.stageVisited[e]?t=!0:this.stageVisited[e-1]&&(t=!0),t&&(this.currentStage=e)}},{key:"startAgain",value:function(){this.currentStage=0,this.stageVisited=[!0,!1,!1,!1,!1],this.json={single:{borderEast:void 0,borderNorth:void 0,borderSouth:void 0,borderWest:void 0,center:void 0,stitches:void 0},double:{center:void 0,innerBorderEast:void 0,innerBorderNorth:void 0,innerBorderSouth:void 0,innerBorderWest:void 0,outerBorderEast:void 0,outerBorderNorth:void 0,outerBorderSouth:void 0,outerBorderWest:void 0,stitches:void 0},piping:{center:void 0,innerBorderEast:void 0,innerBorderNorth:void 0,innerBorderSouth:void 0,innerBorderWest:void 0,outerBorderEast:void 0,outerBorderNorth:void 0,outerBorderSouth:void 0,outerBorderWest:void 0,stitches:void 0}},this.centerMaterial=void 0,this.loadedTextures={},this.materialChoice={single:{border:void 0,center:void 0,stitches:void 0},double:{center:void 0,innerBorder:void 0,outerBorder:void 0,stitches:void 0},piping:{center:void 0,innerBorder:void 0,outerBorder:void 0,stitches:void 0}}}}]),e}();RugBuilder.prototype.start=function(){function e(){function e(e){return function(t){var n=new THREE.MeshLambertMaterial({color:14540253}),a=new THREE.Mesh(t,n);a.name=e,r._singleObjects.push(a)}}function t(){function e(){requestAnimationFrame(e),r._renderer.render(r._scene,r._camera)}clearInterval(v);for(var t=0;t<r._singleObjects.length;t++)r._scene.add(r._singleObjects[t]);r._orbitControls=new THREE.OrbitControls(r._camera),e()}var n=r.btnExitComponent(),a=r.btnRestartComponent(),o=r.btnStageComponent();r.menuComponent(n,a,o);var i=r.btnExpandCollapseComponent(),s=r.btnMaterialComponent(),c=r.btnCollectionComponent(),l=r.btnSwatchComponent(),d=r.sideMenuComponent();r.drawerComponent(i,s,c,l,d),r._scene=new THREE.Scene,r._camera=new THREE.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,1e4),r._renderer=new THREE.WebGLRenderer,r._camera.position.x=-58.25551669838936,r._camera.position.y=103.7487525991614,r._camera.position.z=132.44381733713013,r._camera.rotation.x=-.6645005541912388,r._camera.rotation.y=-.33334042300972533,r._camera.rotation.z=-.25090904322969587,r._renderer.setSize(window.innerWidth,window.innerHeight),r._renderer.setClearColor(15987699),r._renderer.gammaInput=!0,r._renderer.gammaOutput=!0,r._spotLight=new THREE.SpotLight(16777215,1,0,.3141592653589793,0,1),r._spotLight2=new THREE.SpotLight(16777215,.7,0,.3141592653589793,0,1),r._ambientLight=new THREE.AmbientLight(16777215),r._directionalLight=new THREE.DirectionalLight(16777215),r._spotLight.position.set(216.55,238.95,-217.97),r._spotLight2.position.set(307.15,157.37,-80.38),r._directionalLight.position.set(0,0,1),r._scene.add(r._camera),r._scene.add(r._spotLight),r._scene.add(r._spotLight2);var u=["border-east","border-north","border-south","border-west","center","stitches","trim-east","trim-north","trim-south","trim-west"];r._singleObjects=[];for(var h=0;h<u.length;h++){var p=templateDirectoryUri+"/rugbuilder/json/single/"+u[h]+".json",m=u[h];(new THREE.BufferGeometryLoader).load(p,e(m))}var v=setInterval(function(){u.length===r._singleObjects.length&&t()},1e3);document.body.appendChild(r._renderer.domElement)}function t(e){var t=void 0;switch(e){case 0:t="materials";break;case 1:t="collections"}var r="Error at "+t+" stage.";alert(r)}var r=rugBuilder;r.getMaterialsData().then(function(){return r.getCollectionsData()}).then(function(){e()}).catch(function(e){t(e)})},RugBuilder.prototype.getMaterialsData=function(){return new Promise(function(e,t){var r=rugBuilder,n=r.context;!function(){switch(n){case"website":var a=function(){200!==this.status&&t(0),r.materials=JSON.parse(this.response),e(!0)},o=function(){var e=new XMLHttpRequest;e.addEventListener("load",a),e.open("GET","http://localhost:8888/crucial-trading/rugbuilder/?request=materials"),e.send()};o()}}()})},RugBuilder.prototype.getCollectionsData=function(){return new Promise(function(e,t){var r=rugBuilder,n=r.context;!function(){switch(n){case"website":var a=function(){200!==this.status&&t(1),r.collections=JSON.parse(this.response),e(!0)},o=function(){var e=new XMLHttpRequest;e.addEventListener("load",a),e.open("GET","http://localhost:8888/crucial-trading/rugbuilder/?request=collections"),e.send()};o()}}()})},RugBuilder.prototype.getSwatchData=function(e){return new Promise(function(t,r){var n=rugBuilder,a=n.context;!function(){switch(a){case"website":var n=function(){200!==this.status&&r(0),t(JSON.parse(this.response))},o=function(){var t=new XMLHttpRequest;t.addEventListener("load",n),t.open("GET","http://localhost:8888/crucial-trading/rugbuilder/?request=swatches&collection="+e),t.send()};o()}}()})},RugBuilder.prototype.displayTexture=function(e,t){var r=rugBuilder,n="AudreyRug1"===e?"cotton-herringbone":"biscayne-bs105",a=t,o=templateDirectoryUri+"/rugbuilder/img/"+n+"-bmap.jpg";(new THREE.TextureLoader).load(o,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=r._renderer.getMaxAnisotropy(),e.repeat.set(5,5),(new THREE.TextureLoader).load(a,function(t){t.wrapS=t.wrapT=THREE.RepeatWrapping,t.anisotropy=r._renderer.getMaxAnisotropy(),t.repeat.set(5,5);for(var n=new THREE.MeshPhongMaterial({map:t,bumpMap:e,color:16777215,bumpScale:5e-4,shininess:5}),a=0;a<r._singleObjects.length;a++)"center"===r._singleObjects[a].name&&(r._singleObjects[a].material=n)})})},RugBuilder.prototype.btnCollectionComponent=function(){var e=React.createClass({displayName:"BtnCollectionComponent",handleClick:function(){this.props.updateContent("swatches"),this.props.onUpdate(this.props.collection.replace(/ /g,""))},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("h3",null,this.props.collection)))}});return e},RugBuilder.prototype.btnExpandCollapseComponent=function(){var e=React.createClass({displayName:"BtnExpandCollapseComponent",handleClick:function(){this.props.currentState.open?this.props.onUpdate(!0):this.props.onUpdate(!1)},render:function(){return React.createElement("a",{href:"#",className:"expCol",onClick:this.handleClick},this.props.currentState.text)}});return e},RugBuilder.prototype.btnMaterialComponent=function(){var e=(rugBuilder,React.createClass({displayName:"BtnMaterialComponent",handleClick:function(){this.props.updateContent("collections"),this.props.updateMaterial(this.props.material)},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.material}),React.createElement("h3",null,this.props.material)))}}));return e},RugBuilder.prototype.btnSwatchComponent=function(){var e=React.createClass({displayName:"BtnSwatchComponent",handleClick:function(){this.props.updateContent("swatchesSelected"),this.props.onUpdate(this.props.swatch.replace(/ /g,""),this.props.thumb)},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.swatch}),React.createElement("h3",null,this.props.code)))}});return e},RugBuilder.prototype.drawerComponent=function(e,t,r,n,a){var o=rugBuilder,i=React.createClass({displayName:"DrawerComponent",getInitialState:function(){var e=o.materials,t=o.collections;return{content:"materials",open:!1,text:"Expand",chosenMaterial:"Wool",chosenCollection:void 0,chosenSwatch:void 0,_materials:e,_collections:t,_swatches:{}}},updateOpenState:function(e){e?this.setState({open:!1,text:"Expand"}):this.setState({open:!0,text:"Collapse"})},updateContentState:function(e){this.setState({content:e})},updateMaterialChoice:function(e){this.setState({chosenMaterial:e,chosenCollection:void 0})},updateCollectionChoice:function(e){var t=this;this.setState({chosenCollection:e}),o.getSwatchData(e).then(function(r){t.state._swatches[e]=r,t.forceUpdate()})},updateSwatchChoice:function(e,t){this.setState({chosenSwatch:e}),o.displayTexture(e,t)},render:function(){var o=this,i=function(){var e=o.state._materials;if("materials"===o.state.content)return e.map(function(e,r){return React.createElement(t,{key:r,index:r,material:e.name,thumb:e.thumb,updateContent:o.updateContentState,updateMaterial:o.updateMaterialChoice,chosenMaterial:o.state.chosenMaterial})})},s=function(e){var t=o.state._materials;return"collections"===o.state.content&&"collections"===e?t.map(function(e,t){return React.createElement(a,{key:t,material:e.name,thumb:e.thumb,onUpdate:o.updateMaterialChoice})}):"swatches"===o.state.content&&"swatches"===e?t.map(function(e,t){return React.createElement(a,{key:t,material:e.name,thumb:e.thumb,updateContent:o.updateContentState,onUpdate:o.updateMaterialChoice})}):"swatchesSelected"===o.state.content&&"swatches--selected"===e?React.createElement(a,{material:o.state.chosenMaterial}):void 0},c=function(){var e=o.state._collections,t=e[o.state.chosenMaterial];if("collections"===o.state.content)return t.map(function(e,t){return React.createElement(r,{key:t,collection:e.name,updateContent:o.updateContentState,onUpdate:o.updateCollectionChoice})})},l=function(e){var t=o.state._swatches,r=t[o.state.chosenCollection];if("swatches"===o.state.content&&"swatches"===e&&void 0!==r)return Object.keys(r).map(function(e,t){var a=r[e],i=a.name,s=a.code,c=a.thumb;return React.createElement(n,{key:t,swatch:i,thumb:c,code:s,updateContent:o.updateContentState,onUpdate:o.updateSwatchChoice})});if("swatchesSelected"===o.state.content&&"swatches--selected"===e){var a=function(){var e=o.state.chosenSwatch,t=o.state._swatches[o.state.chosenCollection],r=[],a=void 0,i=0;Object.keys(t).forEach(function(n){n===e&&(a=i),r[i]=t[n],i++});var s=[];if(a<=1){for(var c=0;c<a;c++)void 0!==r[c]&&s.push(r[c]);s.push(r[a]);for(var l=a+1;l<5;l++)void 0!==r[l]&&s.push(r[l])}else if(a>r.length-2){for(var d=a===r.length?2:1,u=2+d,h=a-u;h<a;h++)void 0!==r[h]&&s.push(r[h]);s.push(r[a]);for(var p=5-s.length,m=1+p,v=a+1;v<m;v++)void 0!==r[v]&&s.push(r[v])}else for(var g=a-2;g<a+3;g++)void 0!==r[g]&&s.push(r[g]);return{v:s.map(function(e,t){return React.createElement(n,{key:t,swatch:e.name,updateContent:o.updateContentState,onUpdate:o.updateSwatchChoice})})}}();if("object"===("undefined"==typeof a?"undefined":_typeof(a)))return a.v}},d=function(){if("border"===o.state.content)return React.createElement("p",null,"abc")},u=o.state.open?"open":"closed",h="drawer__content "+u+" "+this.state.content;return React.createElement("div",{className:"react-container drawer__container"},React.createElement("div",{className:h},React.createElement("div",{className:"drawer__content__material"},React.createElement("ul",null,i())),React.createElement("div",{className:"drawer__content__collections clearfix"},React.createElement("div",{className:"drawer__collections__sidebar"},React.createElement("ul",null,s("collections"))),React.createElement("div",{className:"drawer__collections__collections"},React.createElement("ul",{className:"clearfix"},c()))),React.createElement("div",{className:"drawer__content__swatches clearfix"},React.createElement("div",{className:"drawer__swatches__sidebar"},React.createElement("ul",null,s("swatches"))),React.createElement("div",{className:"drawer__swatches__swatches"},React.createElement("ul",{className:"clearfix"},l("swatches")))),React.createElement("div",{className:"drawer__content__swatches--selected"},React.createElement("div",{className:"drawer__swatches--selected__sidebar"},React.createElement("ul",null,s("swatches--selected"))),React.createElement("div",{className:"drawer__swatches--selected__swatches"},React.createElement("ul",null,l("swatches--selected")))),React.createElement("div",{className:"drawer__content__border"},d())),React.createElement(e,{onUpdate:this.updateOpenState,currentState:this.state}))}});ReactDOM.render(React.createElement(i,null),document.querySelector("#drawer"))},RugBuilder.prototype.sideMenuComponent=function(){var e=React.createClass({displayName:"SideMenuComponent",handleClick:function(){this.props.onUpdate(this.props.material),this.props.updateContent&&this.props.updateContent("collections")},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.material}),React.createElement("h3",null,this.props.material)))}});return e},RugBuilder.prototype.btnExitComponent=function(){var e=React.createClass({displayName:"BtnExitComponent",render:function(){return React.createElement("a",{href:"http://localhost:8888/crucial-trading",className:"progress-menu__exit"},"Exit")}});return e},RugBuilder.prototype.btnRestartComponent=function(){var e=React.createClass({displayName:"BtnRestartComponent",render:function(){return React.createElement("a",{href:"#",className:"progress-menu__restart"},"Start Again")}});return e},RugBuilder.prototype.btnStageComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"BtnStageComponent",getInitialState:function(){return{marginLeft:0}},componentWillMount:function(){this.calcMargin(),window.addEventListener("resize",this.calcMargin)},handleClick:function(){var t=e.currentStage,r=this.props.index;t!==r&&(t+1===r?e.nextStage():t-1===r?e.prevStage():e.updateStage(r))},calcMargin:function(){if(!(this.props.index>0)){var t=window.innerWidth,r=e.currentStage;if(t>768||0===r)return void this.setState({marginLeft:0});var n=5*t*.16,a=t-n,o=a/2,i=n*r-o,s="-"+i+"px";this.setState({marginLeft:s})}},render:function(){var t=e.currentStage,r="";r=this.props.index===t?"active":this.props.index>t?"next":"prev";var n={marginLeft:this.state.marginLeft},a="progress-menu__stage "+r;return React.createElement("li",{className:a,style:n},React.createElement("a",{href:"#",className:"progress-menu__stage__link",onClick:this.handleClick},this.props.stage))}});return t},RugBuilder.prototype.menuComponent=function(e,t,r){var n=React.createClass({displayName:"MenuComponent",render:function(){var n=["Center","Border Type","Inner Border","Outer Border","Rug Size"],a=n.map(function(e,t){return React.createElement(r,{stage:e,key:t,index:t})});return React.createElement("div",{className:"progress-menu__container"},React.createElement("div",{className:"progress-menu__top"},React.createElement("img",{src:"assets/logo.png",alt:"Crucial Trading Rug Builder"}),React.createElement(t,null),React.createElement(e,null)),React.createElement("div",{className:"progress-menu__bottom"},React.createElement("ul",{className:"progress-menu__stages"},a)))}});ReactDOM.render(React.createElement(n,null),document.querySelector("#progress-menu"))};
//# sourceMappingURL=maps/rugBuilder.min.js.map
