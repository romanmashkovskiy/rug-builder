"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _loadMaps(e,t,r,n){return void 0!==t&&("object"===_typeof(t.nmap)&&Object.keys(t.nmap).forEach(function(a){var i=t.nmap[a].full_url;(new THREE.TextureLoader).load(i,function(t){t=_setRepeat(r,t,n),e.normalMap=t,e.needsUpdate=!0})}),"object"===_typeof(t.bmap)&&Object.keys(t.bmap).forEach(function(a){var i=t.bmap[a].full_url;(new THREE.TextureLoader).load(i,function(t){t=_setRepeat(r,t,n),e.bumpMap=t,e.needsUpdate=!0})}),"object"===_typeof(t.dmap)&&Object.keys(t.dmap).forEach(function(a){var i=t.dmap[a].full_url;(new THREE.TextureLoader).load(i,function(t){t=_setRepeat(r,t,n),e.displacementMap=t,e.displacementScale=2,e.needsUpdate=!0})})),!1}function _setRepeat(e,t,r){var n=rugBuilder,a=0===r?5:10,i=void 0,o=void 0;return"object"===(void 0===e?"undefined":_typeof(e))?(i=parseInt(e.x),o=parseInt(e.y),2===r&&"double"===n.borderType&&(i=5*parseInt(e.x),o=parseInt(e.y)/2),""!==e.x&&""!==e.y?t.repeat.set(i,o):""!==e.x?t.repeat.set(i,a):""!==e.y?t.repeat.set(a,o):t.repeat.set(a,a)):t.repeat.set(a,a),t}function _setStitchingColor(e){var t=rugBuilder,r=e.substr(1),n="0x"+r;return t.json[t.borderType].stitches.material.color.setHex(n),!1}function _loadFiles(e,t,r,n){return new Promise(function(a,i){for(var o=[],s=0;s<e.length;s++)if(void 0===t.json[n][e[s]]){var c=templateDirectoryUri+"/rugbuilder/json/"+r+"/"+e[s]+".json",l=e[s];(new THREE.BufferGeometryLoader).load(c,function(e){return function(r){var a=new THREE.MeshLambertMaterial({color:14540253}),i=new THREE.Mesh(r,a),s=window.innerHeight;s<1e3&&s>850?(i.scale.x=.8,i.scale.y=.8,i.scale.z=.8):s<850&&s>700?(i.scale.x=.65,i.scale.y=.65,i.scale.z=.65):s<700&&(i.scale.x=.5,i.scale.y=.5,i.scale.z=.5),i.name=e,o.push(i),t.json[n][e]=i}}(l))}else o.push(t.json[n][e[s]]);var d=0,u=setInterval(function(){e.length===o.length&&(a(),clearInterval(u)),d++},100)})}function _updateScene(e,t){return new Promise(function(r,n){for(var a=e.scene.children.length,i=void 0,o=0;o<a;o++)if("Mesh"===e.scene.children[o].type){i=o;break}for(var s=0;s<a;s++)e.scene.remove(e.scene.children[i]);Object.keys(e.json[t]).forEach(function(r){e.scene.add(e.json[t][r]),void 0!==e.centerMaterial&&"center"===r&&(e.scene.children[e.scene.children.length-1].material=e.loadedTextures[e.centerMaterial])}),PubSub.publish("borderUpdate",t),e.loadingScreens("full","close"),1===e.currentStage&&document.querySelector(".progress-menu__stage.active").nextSibling.children[0].click(),r()})}function _createMaterialHTML(e,t,r){if(1!==e.state.stage){var n=e.state._materials;return"materials"===e.state.content?n.map(function(r,n){return React.createElement(t,{key:n,index:n,material:r.name,thumb:r.thumb,currentStage:e.state.stage,updateContent:e.updateContentState,updateMaterial:e.updateMaterialChoice})}):void 0}}function _createSidebarHTML(e,t,r,n){if(1!==e.state.stage){var a=e.state._materials;return"collections"===e.state.content&&"collections"===r?a.map(function(r,n){return React.createElement(t,{key:n,material:r.name,thumb:r.thumb,onUpdate:e.updateMaterialChoice})}):"swatches"===e.state.content&&"swatches"===r?a.map(function(r,n){return React.createElement(t,{key:n,material:r.name,thumb:r.thumb,updateContent:e.updateContentState,onUpdate:e.updateMaterialChoice})}):"swatchesSelected"===e.state.content&&"swatches--selected"===r?a.map(function(r,n){if(r.name===e.state.chosenMaterial)return React.createElement(t,{key:n,material:e.state.chosenMaterial,thumb:r.thumb,updateContent:e.updateContentState,onUpdate:e.updateMaterialChoice})}):void 0}}function _createCollectionsHTML(e,t,r){if(1!==e.state.stage&&4!==e.state.stage){var n=e.state._collections,a=n[e.state.chosenMaterial];if(void 0===a)return React.createElement("span",null);var i=void 0;return window.innerWidth>768?(i=Math.ceil(a.length/12),r.numOfPages=i):(i=1,r.numOfPages=i),"collections"===e.state.content?a.map(function(r,n){var a=n+1,i=void 0;return i=window.innerWidth>768?Math.ceil(a/12):1,React.createElement(t,{key:n,title:r.name,collection:r.slug,image:r.thumbnail,updateContent:e.updateContentState,onUpdate:e.updateCollectionChoice,page:i,pageInView:e.state.pageInView})}):void 0}}function _createSwatchesHTML(e,t,r,n){if(1!==e.state.stage)if("Single & Piping"===e.state.chosenBorder&&3===e.state.stage){var a=e.state._piping;if("swatches"===e.state.content&&"swatches"===r){return n.numOfPages=1,a.map(function(r,n){var a=r.ID,i=r.code,o=r.post_title,s=r.picture,c=r.thumb,l={x:r.repeatx,y:r.repeaty},d=!1;Object.keys(r.rthumb).length>0&&(d=r.rthumb);var u={};r.bmap.length>0&&(u.bmap=r.bmap),r.nmap.length>0&&(u.nmap=r.nmap),r.dmap.length>0&&(u.dmap=r.dmap);return React.createElement(t,{key:n,id:a,swatch:o,picture:s,thumb:c,rthumb:d,repeat:l,maps:u,code:i,updateContent:e.updateContentState,onUpdate:e.updateSwatchChoice,page:1,pageInView:1})})}if("swatchesSelected"===e.state.content&&"swatches--selected"===r){var i=e.state.chosenSwatch,o=window.innerWidth>992?6:3,s=a.length;if(void 0!==i){var c=Math.ceil(s/o);n.numOfPages=c}var l=void 0;if(a.map(function(e,t){e.post_title===i&&(l=t)}),!e.state.drawerSlide){var d=l+1,u=Math.ceil(d/o);e.state.pageInView=u}return a.map(function(r,n){var a=r.ID,i=r.post_title,s=r.code,c=r.picture,l=r.thumb,d={x:r.repeatx,y:r.repeaty},u=!1;Object.keys(r.rthumb).length>0&&(u=r.rthumb);var p={};r.bmap.length>0&&(p.bmap=r.bmap),r.nmap.length>0&&(p.nmap=r.nmap),r.dmap.length>0&&(p.dmap=r.dmap);var h=n+1,m=Math.ceil(h/o);return React.createElement(t,{key:n,id:a,swatch:i,picture:c,thumb:l,rthumb:u,repeat:d,maps:p,code:s,updateContent:e.updateContentState,onUpdate:e.updateSwatchChoice,page:m,pageInView:e.state.pageInView})})}}else{var p=e.state._swatches,h=p[e.state.chosenCollection];if("swatches"===e.state.content&&"swatches"===r&&void 0!==h){var m=window.innerWidth>992?18:9;if(void 0!==h){var g=Math.ceil(Object.keys(h).length/m);n.numOfPages=g}return Object.keys(h).map(function(r,n){var a=h[r],i=a.id,o=a.name,s=a.code,c=a.picture,l=a.thumb,d=a.stitching,u={x:a.repeatx,y:a.repeaty},p=!1;"Double Border"===e.state.chosenBorder&&2===e.state.stage&&(p={x:a.repeatxinner,y:a.repeatyinner});var g=!1;Object.keys(a.rthumb).length>0&&(g=a.rthumb);var w={};""!==a.bmap&&(w.bmap=a.bmap),""!==a.nmap&&(w.nmap=a.nmap),""!==a.dmap&&(w.dmap=a.dmap);var f=n+1,b=Math.ceil(f/m);return React.createElement(t,{key:n,id:i,swatch:o,picture:c,thumb:l,rthumb:g,repeat:u,innerRepeat:p,stitching:d,code:s,maps:w,updateContent:e.updateContentState,onUpdate:e.updateSwatchChoice,page:b,pageInView:e.state.pageInView})})}if("swatchesSelected"===e.state.content&&"swatches--selected"===r){var w=e.state.chosenSwatch.replace(/ /g,""),f=e.state._swatches[e.state.chosenCollection],b=window.innerWidth>992?6:3,v=Object.keys(f).length;if(void 0!==f){var _=Math.ceil(v/b);n.numOfPages=_}var S=void 0,y=0;if(Object.keys(f).forEach(function(e){e===w&&(S=y),y++}),!e.state.drawerSlide){var C=S+1,R=Math.ceil(C/b);e.state.pageInView=R}return Object.keys(f).map(function(r,n){var a=h[r],i=(a.id,a.name),o=a.code,s=a.picture,c=a.thumb,l=a.stitching,d={x:a.repeatx,y:a.repeaty},u=!1;"Double Border"===e.state.chosenBorder&&2===e.state.stage&&(u={x:a.repeatxinner,y:a.repeatyinner});var p=!1;"object"===_typeof(a.rthumb)&&(p=a.rthumb);var m={};""!==a.bmap&&(m.bmap=a.bmap),""!==a.nmap&&(m.nmap=a.nmap),""!==a.dmap&&(m.dmap=a.dmap);var g=n+1,w=Math.ceil(g/b);return React.createElement(t,{key:n,swatch:i,picture:s,thumb:c,rthumb:p,repeat:d,innerRepeat:u,stitching:l,code:o,maps:m,selected:e.state.chosenSwatch,updateContent:e.updateContentState,onUpdate:e.updateSwatchChoice,page:w,pageInView:e.state.pageInView})})}}}function _createBorderHTML(e,t,r){if(1===e.state.stage&&"border"===e.state.content){return e.state._borders.map(function(r,n){return React.createElement(t,{key:n,border:r,onUpdate:e.updateBorderChoice})})}}function _createSizeHTML(e,t){if(4===e.state.stage)return React.createElement("span",null,React.createElement("p",{className:"length"},"Length (m)"),React.createElement("p",{className:"width"},"Width (m)"),React.createElement("input",{type:"number",onChange:e.handleSizeInputChange,value:e.state.length,name:"length",className:"input-length",placeholder:"Enter Length (m)"}),React.createElement("input",{type:"number",onChange:e.handleSizeInputChange,value:e.state.width,name:"width",className:"input-width",placeholder:"Enter Width (m)"}),e.state.inputSizeErrorMessage&&React.createElement("span",{className:"sizeInputErrorMessage"}," ",e.state.inputSizeErrorMessage," "),React.createElement("button",{type:"button",onClick:e.fireCalculatePrice,className:"calc-price-btn"},"Calculate Price"))}function _createPriceHTML(e,t){return React.createElement("div",null)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),RugBuilder=function(){function e(t){_classCallCheck(this,e),this.context=t,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.currentStage=0,this.stages=["center","borderType","innerBorder","outerBorder","size"],this.stageVisited=[!0,!1,!1,!1,!1],this.numOfPages=1,this.WCmaterials=[],this.WCcollections=[],this.WCswatches={},this.WCborderMaterials=[],this.WCBorderCollections={},this.WCborderSwatches={},this.WCpiping={},this.scene=void 0,this.renderer=void 0,this.camera=void 0,this.cameraOptions={aspectRatio:this.screenWidth/this.screenHeight,far:1e3,near:.1,viewAngle:90},this.helpers={axis:void 0,grid:void 0,spotLight:void 0},this.lights={},this.orbitControls=void 0,this.originalJson={single:{"border-east":void 0,"border-north":void 0,"border-south":void 0,"border-west":void 0,center:void 0},double:{"border-inner-east":void 0,"border-inner-north":void 0,"border-inner-south":void 0,"border-inner-west":void 0,"border-outer-east":void 0,"border-outer-north":void 0,"border-outer-south":void 0,"border-outer-west":void 0,center:void 0},piping:{center:void 0,"border-east":void 0,"border-north":void 0,"border-south":void 0,"border-west":void 0,"trim-east":void 0,"trim-north":void 0,"trim-south":void 0,"trim-west":void 0}},this.json=this.originalJson,this.loadedTextures={},this.borderType=void 0,this.centerMaterial=void 0,this.borderMaterials={single:void 0,piping:{inner:void 0,piping:void 0},double:{inner:void 0,outer:void 0}},this.centerID=0,this.singleBorderID=0,this.pipingID=0,this.innerBorderID=0,this.outerBorderID=0,this.length=0,this.width=0,this.price=0,this.errors={100:"Material Loading Stage",101:"Collection Loading Stage",102:"Swatch Loading Stage",103:"Border Material Loading Stage",200:"Loading Single Border Into Three",201:"Loading Single & Piping Border Into Three",202:"Loading Double Border Into Three"}}return _createClass(e,[{key:"nextStage",value:function(){var e=this.currentStage+1;if(e>4)throw new Error("Cannot go higher than stage 4");this.stageVisited[e]||(this.stageVisited[e]=!0),this.currentStage=e,PubSub.publish("stageChange",e)}},{key:"prevStage",value:function(){var e=this.currentStage-1;if(e<0)throw new Error("Cannot go lower than stage 0");this.currentStage=e,PubSub.publish("stageChange",e)}},{key:"updateStage",value:function(e){if(e<0||e>4)throw new Error("Stage must not be less than 0 or greater than 4");var t=!1;this.currentStage+1===e?t=!0:this.stageVisited[e]?t=!0:this.stageVisited[e-1]?t=!0:0===this.currentStage&&2===e?t=!0:"single"===this.borderType&&2===this.currentStage&&4===e&&(t=!0),t&&(this.currentStage=e,PubSub.publish("stageChange",e))}},{key:"changeView",value:function(e){return this.camera.updateProjectionMatrix(),0===e?(this.camera.position.x=-40,this.camera.position.y=170,this.camera.position.z=0,this.camera.rotation.x=-1.5708,this.camera.rotation.y=0,this.camera.rotation.z=1.5708,1):1===e?(this.camera.position.x=70,this.camera.position.y=97.86732004062627,this.camera.position.z=108.5265830159921,this.camera.rotation.x=-.7337987907741792,this.camera.rotation.y=.47612198934967903,this.camera.rotation.z=.3919353811096299,2):2===e?(this.camera.position.x=-65,this.camera.position.y=146.97868270469004,this.camera.position.z=.00630814379798243,this.camera.rotation.x=-1.5707534317349763,this.camera.rotation.y=-.5996570925812806,this.camera.rotation.z=-1.5707203029033585,3):3===e?(this.camera.position.x=0,this.camera.position.y=170,this.camera.position.z=-55,this.camera.rotation.x=-1.5708,this.camera.rotation.y=0,this.camera.rotation.z=0,0):void 0}},{key:"zoomIn",value:function(){var e=.35;window.innerHeight<850&&(e=.4),window.innerHeight<750&&(e=.7),window.innerHeight<650&&(e=.7),window.innerHeight<550&&(e=.9),window.innerHeight<450&&(e=.11);var t=11*e,r=this.camera.zoom+e;return r>t&&(r=t),this.camera.zoom=r,this.camera.updateProjectionMatrix(),!0}},{key:"zoomOut",value:function(){var e=.35;window.innerHeight<850&&(e=.4),window.innerHeight<750&&(e=.7),window.innerHeight<650&&(e=.7),window.innerHeight<550&&(e=.9),window.innerHeight<450&&(e=.11);var t=this.camera.zoom,r=t-e;if(!(r<1.33))return this.camera.zoom=r,this.camera.updateProjectionMatrix(),!0}},{key:"startAgain",value:function(){if(this.currentStage=0,this.stageVisited=[!0,!1,!1,!1,!1],this.json=this.originalJson,this.loadedTextures={},this.borderType=void 0,this.centerMaterial=void 0,this.borderMaterials={single:void 0,piping:{inner:void 0,piping:void 0},double:{inner:void 0,outer:void 0}},this.centerID=0,this.singleBorderID=0,this.pipingID=0,this.innerBorderID=0,this.outerBorderID=0,this.length=0,this.width=0,this.price=0,this.changeView(0),this.zoomIn(),window.innerHeight<950)for(var e=950-window.innerHeight,t=Math.ceil(e/100),r=0;r<t;r++)this.zoomIn();this.camera.updateProjectionMatrix(),PubSub.publish("stageChange",0),PubSub.publish("newPrice",[0,0,0])}},{key:"calculatePrice",value:function(e,t){var r=this,n=rugBuilder;if(0===e||""===e||0===t||""===t)return void PubSub.publish("newPrice",0);var a=this.centerMaterial;this.getPriceData(a).then(function(a){var i=e*t,o=a*i,s=void 0,c=n.borderType,l=!1,d=!1;switch(c){case"single":var u=n.borderMaterials.single.split(" ").join("");l=n.WCswatches[u];break;case"piping":var p=n.borderMaterials.piping.inner.split(" ").join(""),h=n.borderMaterials.piping.piping;l=n.WCswatches[p];for(var m=0;m<n.WCpiping.length;m++)if(h===n.WCpiping[m].post_title){n.WCpiping[m];break}break;case"double":var g=n.borderMaterials.double.inner.split(" ").join(""),w=n.borderMaterials.double.outer.split(" ").join("");l=n.WCswatches[g],d=n.WCswatches[w]}if("single"===c){for(var f=void 0,b=0,v=0;v<l.cats.length;v++)if(487===l.cats[v].parent){f=l.cats[v].slug;break}"cotton"===f||"linen"===f?b=17:"leather"!==f&&"suede"!==f||(b=38),s=b*(2*e+2*t)}else if("piping"===c){for(var _=void 0,S=0,y=0;y<l.cats.length;y++)if(487===l.cats[y].parent){_=l.cats[y].slug;break}"cotton"===_||"linen"===_?S=25:"leather"!==_&&"suede"!==_||(S=50);var C=S*(2*e+2*t),R=0*(2*e+2*t);s=C+R}else if("double"===c){for(var E=void 0,M=void 0,B=0;B<l.cats.length;B++)if(487===l.cats[B].parent){E=l.cats[B].slug;break}for(var k=0;k<d.cats.length;k++)if(487===d.cats[k].parent){M=d.cats[k].slug;break}var x=void 0;switch(E){case"cotton":case"linen":"cotton"===M?x=25:"linen"===M?x=25:"suede"===M?x=50:"leather"===M&&(x=50);break;case"leather":case"suede":"cotton"===M?x=50:"linen"===M?x=50:"suede"===M?x=60:"leather"===M&&(x=60)}s=x*(2*e+2*t)}var L=parseFloat(o+s),I=L.toFixed(2),T=I;if(parseInt(e)>4&&parseInt(t)<2){var z=I/100,N=25*z;T=parseFloat(I+N).toFixed(2)}PubSub.publish("newPrice",[T,e,t]),r.length=e,r.width=t,r.price=T}).catch(function(){n.error(1e3,!0)})}}]),e}();RugBuilder.prototype.start=function(){function e(){function e(){function e(){requestAnimationFrame(e),r.renderer.render(r.scene,r.camera)}function t(){r.screenWidth=window.innerWidth,r.screenHeight=window.innerHeight,r.cameraOptions.aspectRatio=r.screenWidth/r.screenHeight,r.camera.aspect=r.cameraOptions.aspectRatio,r.camera.updateProjectionMatrix(),r.renderer.setSize(r.screenWidth,r.screenHeight),r.screenHeight>=1e3?Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=1,r.json[e][t].scale.y=1,r.json[e][t].scale.z=1)})}):r.screenHeight<1e3&&r.screenHeight>850?(r.camera.position.z=-62,Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=.8,r.json[e][t].scale.y=.8,r.json[e][t].scale.z=.8)})})):r.screenHeight<850&&r.screenHeight>700?(r.camera.position.z=-70,Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=.65,r.json[e][t].scale.y=.65,r.json[e][t].scale.z=.65)})})):r.screenHeight<700&&(r.camera.position.z=-90,Object.keys(r.json).forEach(function(e){Object.keys(r.json[e]).forEach(function(t){void 0!==r.json[e][t]&&(r.json[e][t].scale.x=.5,r.json[e][t].scale.y=.5,r.json[e][t].scale.z=.5)})})),e()}r.initOrbit(),r.camera.position.x=-40,r.camera.position.y=0;var n=window.innerHeight;n>1e3?r.camera.position.z=-55:n<1e3&&n>850?r.camera.position.z=-62:n<850&&n>700?r.camera.position.z=-70:n<700&&(r.camera.position.z=-90),r.camera.rotation.x=-1.5708,r.camera.rotation.z=0,r.camera.rotation.z=0,e(),document.querySelector("#background-div").style.background="none",document.querySelector("#background-div").style.zIndex="-9",r.changeView(0),r.zoomIn(),window.addEventListener("resize",t,!1)}var n=r.btnExpandCollapseComponent(),a=r.btnMaterialComponent(),i=r.btnCollectionComponent(),o=r.btnSwatchComponent(),s=r.btnBorderComponent(),c=r.sideMenuComponent();r.drawerComponent(n,a,i,o,c,s),r.priceComponent(),r.viewControls(),r.initThree(),r.initLights(),r.initScene(),r.updateBorder("Single Border").then(function(){e()}).catch(function(e){t(e)})}function t(e){var t=void 0;switch(e){case 100:t="An error occured loading the materials.";break;case 101:t="An error occured loading the collections";break;case 200:t="An error occured loading the single border JSON";case 201:t="An error occured loading the piping border JSON";case 202:t="An error occured loading the double border JSON";default:e=1e3,t="An error occured"}r.error(e,t,!0)}window.onerror=function(e,t,n,a,i){var o={msg:e,src:t,line:n,col:a,err:i};console.log(o),r.error(1e3,o,!0)};var r=rugBuilder,n=r.btnExitComponent(),a=r.btnRestartComponent(),i=r.btnStageComponent();if(r.menuComponent(n,a,i),!window.WebGLRenderingContext)return void r.showWebGLError(!1);var o=document.createElement("canvas");if(!o.getContext("webgl")&&!o.getContext("experimental-webgl"))return void r.showWebGLError(!0);r.getMaterialsData().then(function(){return r.getCollectionsData()}).then(function(){return r.getMaterialsData("border")}).then(function(){return r.getPipingData()}).then(function(){e()}).catch(function(e){t(e)})},RugBuilder.prototype.getMaterialsData=function(e){return new Promise(function(t,r){var n=rugBuilder;switch(n.context){case"website":var a=function(){200!==this.status&&r(100),"border"===e?n.WCborderMaterials=JSON.parse(this.response):n.WCmaterials=JSON.parse(this.response),t(!0)};!function(){var t=new XMLHttpRequest,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1));var i="materials";"border"===e&&(n.loadingScreens("full","open"),i="border"),t.addEventListener("load",a),t.open("GET",r+"?request="+i),t.send()}()}})},RugBuilder.prototype.getCollectionsData=function(e){return new Promise(function(t,r){var n=rugBuilder;switch(n.context){case"website":var a=function(){200!==this.status&&r(101),e?n.WCBorderCollections[e]=JSON.parse(this.response):n.WCcollections=JSON.parse(this.response),t(JSON.parse(this.response))};!function(){var t=new XMLHttpRequest,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1));var n=r+"?request=collections";e&&(n+="&collection="+e),t.addEventListener("load",a),t.open("GET",n),t.send()}()}})},RugBuilder.prototype.getPipingData=function(){return new Promise(function(e,t){var r=rugBuilder;switch(r.context){case"website":var n=function(){200!==this.status&&t(100);var n=JSON.parse(this.response);r.WCpiping=n;for(var a in n){var i=n[a].post_title.replace(/ /g,"");r.WCswatches[i]=n[a]}e(!0)};!function(){var e=new XMLHttpRequest,t=window.location.href;"#"===t[t.length-1]&&(t=t.substr(0,t.length-1));var r=t+"?request=piping";e.addEventListener("load",n),e.open("GET",r),e.send()}()}})},RugBuilder.prototype.getSwatchData=function(e){return new Promise(function(t,r){var n=rugBuilder;switch(n.context){case"website":var a=function(){200!==this.status&&r(0);var e=JSON.parse(this.response);for(var a in e)n.WCswatches[a]=e[a];t(JSON.parse(this.response))};!function(){var t=new XMLHttpRequest,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1));var n=e.toLowerCase();t.addEventListener("load",a),t.open("GET",r+"?request=swatches&collection="+n),t.send()}()}})},RugBuilder.prototype.getPriceData=function(e){return new Promise(function(t,r){switch(rugBuilder.context){case"website":var n=function(){if(200!=this.status)return void r();t(JSON.parse(this.response))},a=new XMLHttpRequest,i=window.location.href;"#"===i[i.length-1]&&(i=i.substr(0,i.length-1));var o=i+"?request=price&material="+encodeURIComponent(e);a.addEventListener("load",n),a.open("GET",o),a.send()}})},RugBuilder.prototype.initThree=function(){var e=rugBuilder,t=e.cameraOptions,r=new THREE.Scene;r.background=new THREE.Color(15987699);var n=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialias:!0}),a=new THREE.PerspectiveCamera(t.viewAngle,t.aspectRatio,t.near,t.far);n.gammaInput=!0,n.gammaOutput=!0,n.setSize(window.innerWidth,window.innerHeight),n.setClearColor(15987699),e.scene=r,e.renderer=n,e.camera=a},RugBuilder.prototype.displayTexture=function(e,t,r,n,a,i,o){if(void 0!==t&&null!==t&&1!==r&&4!==r){var s=rugBuilder,c=s.borderType,l=void 0,d=void 0,u=void 0,p=void 0,h=void 0;switch(Object.keys(t).map(function(e){h=t[e].full_url}),o&&"double"===s.borderType&&3===r&&Object.keys(o).map(function(e){h=o[e].full_url}),r){case 0:l="centerMaterial",p=["center"];break;case 2:switch(c){case"single":l="borderMaterials",d="single",p=["border-east","border-north","border-south","border-west"];break;case"piping":l="borderMaterials",d="piping",u="inner",p=["border-east","border-north","border-south","border-west"];break;default:l="borderMaterials",d="double",u="inner",p=["border-inner-east","border-inner-north","border-inner-south","border-inner-west"]}break;case 3:if("piping"===c)l="borderMaterials",d="piping",u="piping",p=["trim-east","trim-north","trim-south","trim-west"];else{if("double"!==c)return;l="borderMaterials",d="double",u="outer",p=["border-outer-east","border-outer-north","border-outer-south","border-outer-west"]}}(new THREE.TextureLoader).load(h,function(t){t.wrapS=t.wrapT=THREE.RepeatWrapping,t.anisotropy=s.renderer.getMaxAnisotropy(),t=_setRepeat(i,t,r);var a=new THREE.MeshPhongMaterial({map:t,color:16777215,shininess:5});s.loadedTextures[e]=a,void 0!==u?s[l][d][u]=e:void 0!==d?s[l][d]=e:s[l]=e;for(var o=0;o<s.scene.children.length;o++)p.indexOf(s.scene.children[o].name)>-1&&(s.scene.children[o].material=s.loadedTextures[e],_loadMaps(s.scene.children[o].material,n,i,r));s.loadingScreens("full","close")})}},RugBuilder.prototype.error=function(e,t,r){function n(){a.error(0,"",!1)}var a=rugBuilder;a.loadingScreens("full","close");var i=new XMLHttpRequest,o=window.location.href;"#"===o[o.length-1]&&(o=o.substr(0,o.length-1));var s=void 0;s="string"==typeof t?encodeURIComponent(t):encodeURIComponent(JSON.stringify(t));var c=o+"?err="+e+"&message="+s;i.open("GET",c),i.send(),document.querySelector("#close-error").addEventListener("click",n);var l=document.querySelector("#error-box"),d=document.querySelector("#error-msg"),u=document.querySelector("#error-code");"string"!=typeof t&&(t="Sorry, an error occured"),d.innerHTML=t,u.innerHTML="Error Code: "+e,l.style.display=r?"block":"none"},RugBuilder.prototype.loadingScreens=function(e,t){var r=void 0;switch(e){case"full":r="#full-loading";break;case"drawer":r="#drawer-loading";break;case"canvas":r="#canvas-loading"}var n="open"===t?99999:-99999;document.querySelector(r).style.zIndex=n},RugBuilder.prototype.showWebGLError=function(e){var t=document.createElement("div"),r=document.createElement("h2");t.style.position="absolute",t.style.top="80px",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.zIndex="999999",t.style.background="white",t.style.padding="50px",t.style.textAlign="center",r.innerHTML=e?"Sorry, WebGL is currently disabled in your browser. Please enable it and refresh the page.":"Sorry, your browser does not support WebGL. Please upgrade to a browser that supports WebGL such as Google Chrome, Firefox, Safari, Internet Explorer 11, or Microsoft Edge.",t.appendChild(r),document.body.appendChild(t)},RugBuilder.prototype.updateBorder=function(e){var t=rugBuilder,r=[];return new Promise(function(n,a){switch(e){case"Single Border":r=["border-east","border-north","border-south","border-west","center"],t.borderType="single",_loadFiles(r,t,"single","single").then(function(){return _updateScene(t,"single")}).then(function(){n()}).catch(function(){a(200)});break;case"Single & Piping":r=["border-east","border-north","border-south","border-west","center","trim-east","trim-north","trim-south","trim-west"],t.borderType="piping",_loadFiles(r,t,"single","piping").then(function(){return _updateScene(t,"piping")}).then(function(){n()}).catch(function(){a(201)});break;case"Double Border":r=["border-inner-east","border-inner-north","border-inner-south","border-inner-west","border-outer-east","border-outer-north","border-outer-south","border-outer-west","center"],t.borderType="double",_loadFiles(r,t,"double","double").then(function(){return _updateScene(t,"double")}).then(function(){n()}).catch(function(){a(202)})}})},RugBuilder.prototype.initLights=function(e){var t=rugBuilder,r=new THREE.SpotLight(16777215,1,0,.3141592653589793,0,1),n=new THREE.SpotLight(16777215,.28,0,.3141592653589793,0,1);r.position.set(-230.44,317.88,-80.68),n.position.set(307.15,157.37,-80.38),t.lights.spotLight=r,t.lights.spotLight2=n},RugBuilder.prototype.initScene=function(){var e=rugBuilder;e.scene.add(e.camera),e.scene.add(e.lights.spotLight),document.body.appendChild(e.renderer.domElement)},RugBuilder.prototype.initOrbit=function(){var e=rugBuilder;e.orbitControls=new THREE.OrbitControls(e.camera,e.renderer.domElement),e.orbitControls.enableZoom=!1,e.orbitControls.maxPolarAngle=Math.PI/2-.1},RugBuilder.prototype.orderScreenComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"OrderScreenComponent",getInitialState:function(){this.centerID=0,this.singleBorderID=0,this.innerBorderID=0,this.pipingID=0,this.outerBorderID=0;var t=e.centerMaterial,r=e.centerID,n=e.borderType,a=!1;"single"===n?a=e.borderMaterials.single:"piping"===n&&(a=e.borderMaterials.piping.inner);var i=("single"===n||"piping"===n)&&e.singleBorderID,o="piping"===n&&e.borderMaterials.piping.piping,s="piping"===n&&e.pipingID,c="double"===n&&e.borderMaterials.double.inner,l="double"===n&&e.innerBorderID;return{centerMaterial:t,centerID:r,borderType:n,singleBorderMaterial:a,pipingMaterial:o,innerBorderMaterial:c,outerBorderMaterial:"double"===n&&e.borderMaterials.double.outer,singleBorderID:i,pipingID:s,innerBorderID:l,outerBorderID:"double"===n&&e.outerBorderID,length:e.length,width:e.width,price:e.price,cameraPosition:e.camera.position,cameraRotation:e.camera.rotation}},edit:function(){e.camera.position.x=this.state.cameraPosition.x,e.camera.position.y=this.state.cameraPosition.y,e.camera.position.z=this.state.cameraPosition.z,e.camera.rotation.x=this.state.cameraRotation.x,e.camera.rotation.y=this.state.cameraRotation.y,e.camera.rotation.z=this.state.cameraRotation.z,e.updateStage(4),ReactDOM.unmountComponentAtNode(document.querySelector("#order-screen"))},print:function(){window.print()},order:function(){var e=this;console.log("order !!");var t=this.state.borderType,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1)),r+="?products=",r+=this.state.centerID+",","single"===t?r+=this.state.singleBorderID:"piping"===t?(r+=this.state.singleBorderID+",",r+=this.state.pipingID):"double"===t&&(r+=this.state.innerBorderID+",",r+=this.state.outerBorderID);new XMLHttpRequest;console.log("url --\x3e"),console.log(r),axios.get(r).then(function(t){console.log(t),console.log("axios get request"),console.log("loaded !!");var r=document.createElement("div"),n=document.createElement("p");r.classList.add("basket-confirm"),n.innerHTML='Samples added to your <a href="'+siteUrl+'/basket">basket</a>.',r.appendChild(n),document.body.appendChild(r),e.basket(),setTimeout(function(){r.classList.add("hidden")},7e3)}).catch(function(e){console.log(e)})},basket:function(){function t(){if(200!==this.status)return void e.error(1e3,this,!0);var t=document.createElement("div"),r=document.createElement("p");t.classList.add("basket-confirm"),r.innerHTML='Rug added to your <a href="'+siteUrl+'/basket">basket</a>.',t.appendChild(r),document.body.appendChild(t),setTimeout(function(){t.classList.add("hidden")},7e3)}var r=this.state.borderType,n=window.location.href;"#"===n[n.length-1]&&(n=n.substr(0,n.length-1));var a=n+"?products="+RUG_ID;a+="&center="+this.state.centerID,a+="&length="+this.state.length,a+="&width="+this.state.width,a+="&price="+this.state.price,"single"===r?a+="&inner="+this.state.singleBorderID:"piping"===r?(a+="&inner="+this.state.singleBorderID,a+="&piping="+this.state.pipingID):"double"===r&&(a+="&inner="+this.state.innerBorderID,a+="&outer="+this.state.outerBorderID);var i=new XMLHttpRequest;i.addEventListener("load",t),i.open("GET",a),i.send()},render:function(){var t={};t.Center=this.state.centerMaterial,"single"===this.state.borderType||"piping"===this.state.borderType?(t.Border=this.state.singleBorderMaterial,"piping"===this.state.borderType&&(t.Piping=this.state.pipingMaterial)):"double"===this.state.borderType&&(t["Inner Border"]=this.state.innerBorderMaterial,t["Outer Border"]=this.state.outerBorderMaterial);var r=document.querySelector("canvas").toDataURL("image/jpeg"),n=decodeURIComponent(r);return e.loadingScreens("full","close"),React.createElement("div",{className:"order"},React.createElement("h2",{className:"order__title"},"Order Rug"),React.createElement("span",{className:"order__underline"}),React.createElement("div",{className:"order__content clearfix"},React.createElement("div",{className:"order__image"},React.createElement("img",{src:n,alt:"Your Rug"})),React.createElement("div",{className:"order__details"},React.createElement("div",{className:"details__row header clearfix"},React.createElement("h3",null,"Material"),React.createElement("h3",null,"Section")),function(){return Object.keys(t).map(function(r,n){var a=t[r].replace(/ /g,""),i=e.WCswatches[a],o="";return void 0!==i&&(o="("+i.code+")"),React.createElement("div",{className:"details__row clearfix",key:n},React.createElement("p",null,t[r]," ",o),React.createElement("p",null,r))})}(),React.createElement("div",{className:"details__row header sizing clearfix"},React.createElement("h3",null,"Sizing"),React.createElement("h3",null,"Price")),React.createElement("div",{className:"details__row clearfix"},React.createElement("p",null,this.state.length,"m x ",this.state.width,"m"),React.createElement("p",null,"£",this.state.price)))),React.createElement("div",{className:"order__links"},React.createElement("a",{href:"#",className:"link__edit",onClick:this.edit},React.createElement("img",{src:"https://d105txpzekqrfa.cloudfront.net/uploads/20170110133914/restart.svg"}),"Edit Rug"),React.createElement("a",{href:"#",className:"link__print",
onClick:this.print},"Print Details"),React.createElement("div",{className:"submit-rug-button-container"},React.createElement("div",null,React.createElement("a",{href:"#",className:"link__basket v2",onClick:this.order},"Submit Rug Quote")),React.createElement("div",null,React.createElement("span",null,"Note: Adds rug and samples to basket")))))}});ReactDOM.render(React.createElement(t,null),document.querySelector("#order-screen"))},RugBuilder.prototype.priceComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"PriceComponent",getInitialState:function(){return{length:0,price:0,width:0}},componentDidMount:function(){this.newPrice=PubSub.subscribe("newPrice",this.showNewPrice)},componentWillUnmount:function(){PubSub.unsubscribe(this.newPrice)},showNewPrice:function(e){var t=e[0],r=e[1],n=e[2];if(0===t)return void this.setState({price:!1});this.setState({length:r,price:t,width:n})},goToOrderScreen:function(){e.camera.position.x=0,e.camera.position.y=170,e.camera.position.z=window.innerHeight/window.innerWidth,e.camera.rotation.x=-1.5708,e.camera.rotation.y=0,e.camera.rotation.z=0,e.camera.zoom=1.5,e.camera.updateProjectionMatrix(),e.loadingScreens("full","open"),setTimeout(function(){e.orderScreenComponent()},10)},render:function(){var e=void 0;return e=this.state.price?React.createElement("span",null,React.createElement("h3",null,"£ ",this.state.price),React.createElement("a",{href:"#",onClick:this.goToOrderScreen},"Finish Building")):"",React.createElement("div",{className:"price__container"},e)}});ReactDOM.render(React.createElement(t,null),document.querySelector("#price"))},RugBuilder.prototype.viewControls=function(){var e=rugBuilder,t=React.createClass({displayName:"ViewControlsComponent",getInitialState:function(){return{view:0}},iconURLS:["https://d105txpzekqrfa.cloudfront.net/uploads/20170131102546/above-horizontal.svg","https://d105txpzekqrfa.cloudfront.net/uploads/20170131102558/angled.svg","https://d105txpzekqrfa.cloudfront.net/uploads/20170131102555/angled-horizontal.svg","https://d105txpzekqrfa.cloudfront.net/uploads/20170131102554/above-vertical.svg"],changeView:function(){var t=e.changeView(this.state.view);this.setState({view:t})},zoomIn:function(){e.zoomIn(this.state.view)},zoomOut:function(){e.zoomOut(this.state.view)},render:function(){var e=this.iconURLS[this.state.view],t="view"+this.state.view;return React.createElement("div",{className:"controls__container"},React.createElement("div",{className:"control"},React.createElement("a",{className:"control__link",onClick:this.changeView},React.createElement("img",{src:e,alt:"Change View",className:t}))),React.createElement("div",{className:"control"},React.createElement("a",{className:"control__link",onClick:this.zoomIn},React.createElement("img",{src:"https://d105txpzekqrfa.cloudfront.net/uploads/20170131102559/zoom-in.svg",alt:"Zoom In",className:"zoom"}))),React.createElement("div",{className:"control"},React.createElement("a",{className:"control__link",onClick:this.zoomOut},React.createElement("img",{src:"https://d105txpzekqrfa.cloudfront.net/uploads/20170131102601/zoom-out.svg",alt:"Zoom Out",className:"zoom"}))))}});ReactDOM.render(React.createElement(t,null),document.querySelector("#view-controls"))},RugBuilder.prototype.btnBorderComponent=function(){return React.createClass({displayName:"BtnBorderComponent",handleClick:function(){this.props.onUpdate(this.props.border)},render:function(){var e=void 0;switch(this.props.border){case"Single Border":e="https://d105txpzekqrfa.cloudfront.net/uploads/2016/11/11174349/single-border-icon.svg";break;case"Single & Piping":e="https://d105txpzekqrfa.cloudfront.net/uploads/2016/11/11174352/single-piping-icon.svg";break;case"Double Border":e="https://d105txpzekqrfa.cloudfront.net/uploads/2016/11/11174338/double-border-icon.svg"}return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:e,alt:this.props.border}),React.createElement("h3",null,this.props.border)))}})},RugBuilder.prototype.btnCollectionComponent=function(){return React.createClass({displayName:"BtnCollectionComponent",handleClick:function(){this.props.updateContent("swatches"),this.props.onUpdate(this.props.collection.replace(/ /g,"-"))},render:function(){var e="page-"+this.props.page;return this.props.page===this.props.pageInView-1?e+=" left-of-window":this.props.page===this.props.pageInView+1?e+=" right-of-window":this.props.page===this.props.pageInView?e+=" in-window":e+=" hidden",React.createElement("li",{className:e,"data-page":this.props.page},React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("h3",null,this.props.title),React.createElement("div",{className:"swatch-img-container"},React.createElement("img",{src:this.props.image}))))}})},RugBuilder.prototype.btnExpandCollapseComponent=function(){return React.createClass({displayName:"BtnExpandCollapseComponent",handleClick:function(){this.props.currentlyOpen?this.props.close():this.props.open()},render:function(){return React.createElement("a",{href:"#",className:"expCol",onClick:this.handleClick},this.props.text)}})},RugBuilder.prototype.btnMaterialComponent=function(){rugBuilder;return React.createClass({displayName:"BtnMaterialComponent",handleClick:function(){this.props.updateContent("collections"),this.props.updateMaterial(this.props.material)},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.material}),React.createElement("h3",null,this.props.material)))}})},RugBuilder.prototype.btnSwatchComponent=function(){return React.createClass({displayName:"BtnSwatchComponent",handleClick:function(){this.props.updateContent("swatchesSelected"),this.props.onUpdate(this.props.swatch,this.props.thumb,this.props.id,this.props.maps,this.props.stitching,this.props.repeat,this.props.innerRepeat,this.props.rthumb)},render:function(){var e=this,t="";this.props.selected===this.props.swatch&&(t="selected "),t+="page-"+this.props.page,this.props.page===this.props.pageInView-1?t+=" left-of-window":this.props.page===this.props.pageInView+1?t+=" right-of-window":this.props.page===this.props.pageInView?t+=" in-window":t+=" hidden";var r="";return Object.keys(this.props.thumb).map(function(t){r=e.props.thumb[t].url}),React.createElement("li",{className:t},React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.picture,alt:this.props.swatch}),React.createElement("h3",null,this.props.code),React.createElement("i",{className:"icon-crucial-tick-thin"})))}})},RugBuilder.prototype.drawerComponent=function(e,t,r,n,a,i){var o=rugBuilder,s=React.createClass({displayName:"DrawerComponent",getInitialState:function(){var e=o.WCmaterials,t=o.WCcollections,r=o.WCpiping;return{stage:o.currentStage,content:"materials",open:!0,text:"Collapse",pageInView:1,chosenMaterial:void 0,chosenCollection:void 0,chosenSwatch:void 0,chosenBorder:"Single & Piping",_materials:e,_collections:t,_piping:r,_swatches:{},_borders:["Single Border","Single & Piping","Double Border"],length:"",width:"",price:!1,_resize:0,drawerSlide:!1,inputSizeErrorMessage:""}},componentDidMount:function(){this.stageChange=PubSub.subscribe("stageChange",this.updateStageState),this.newPrice=PubSub.subscribe("newPrice",this.showNewPrice)},componentWillUnmount:function(){PubSub.unsubscribe(this.stageChange),PubSub.unsubscribe(this.newPrice)},open:function(){document.querySelector(".drawer__content__material").classList.remove("closed"),document.querySelector(".drawer__content__collections").classList.remove("closed"),document.querySelector(".drawer__content__swatches").classList.remove("closed"),document.querySelector(".drawer__content__swatches--selected").classList.remove("closed"),document.querySelector(".drawer__content__border").classList.remove("closed"),document.querySelector(".drawer__content__size").classList.remove("closed"),document.querySelector(".drawer__content__material").classList.add("opening"),document.querySelector(".drawer__content__collections").classList.add("opening"),document.querySelector(".drawer__content__swatches").classList.add("opening"),document.querySelector(".drawer__content__swatches--selected").classList.add("opening"),document.querySelector(".drawer__content__border").classList.add("opening"),document.querySelector(".drawer__content__size").classList.add("opening"),setTimeout(function(){document.querySelector(".drawer__content__material").classList.remove("opening"),document.querySelector(".drawer__content__collections").classList.remove("opening"),document.querySelector(".drawer__content__swatches").classList.remove("opening"),document.querySelector(".drawer__content__swatches--selected").classList.remove("opening"),document.querySelector(".drawer__content__border").classList.remove("opening"),document.querySelector(".drawer__content__size").classList.remove("opening"),document.querySelector(".drawer__content__material").classList.add("open"),document.querySelector(".drawer__content__collections").classList.add("open"),document.querySelector(".drawer__content__swatches").classList.add("open"),document.querySelector(".drawer__content__swatches--selected").classList.add("open"),document.querySelector(".drawer__content__border").classList.add("open"),document.querySelector(".drawer__content__size").classList.add("open")},650),this.setState({open:!0,text:"Collapse"})},close:function(){document.querySelector(".drawer__content__material").classList.remove("open"),document.querySelector(".drawer__content__collections").classList.remove("open"),document.querySelector(".drawer__content__swatches").classList.remove("open"),document.querySelector(".drawer__content__swatches--selected").classList.remove("open"),document.querySelector(".drawer__content__border").classList.remove("open"),document.querySelector(".drawer__content__size").classList.remove("open"),document.querySelector(".drawer__content__material").classList.add("closed"),document.querySelector(".drawer__content__collections").classList.add("closed"),document.querySelector(".drawer__content__swatches").classList.add("closed"),document.querySelector(".drawer__content__swatches--selected").classList.add("closed"),document.querySelector(".drawer__content__border").classList.add("closed"),document.querySelector(".drawer__content__size").classList.add("closed"),this.setState({open:!1,text:"Expand"})},calcDrawerMaxHeight:function(){var e=void 0,t=this.state.stage,r=this.state.content;if(0===t||2===t||3===t)switch(r){case"materials":e=".drawer__content__material";break;case"collections":e=".drawer__collections__collections";break;case"swatches":e=".drawer__content__swatches";break;case"swatchesSelected":e=".drawer__content__swatches--selected"}else 1===t&&(e=".drawer__content__border");var n=document.querySelector(e),a=window.getComputedStyle(n).getPropertyValue("height");n.style.maxHeight=a},slideLeft:function(){if(this.state.pageInView!==o.numOfPages){1===this.state.pageInView&&this.calcDrawerMaxHeight(),this.setState({drawerSlide:!0});var e=[];e.forEach.call(document.querySelectorAll("li.in-window"),function(e,t){e.classList.add("moving-out-to-left")}),e.forEach.call(document.querySelectorAll("li.right-of-window"),function(e,t){e.classList.add("moving-in-from-right")});var t=this,r=this.state.pageInView,n=r+1;setTimeout(function(){t.setState({pageInView:n})},650)}},slideRight:function(){if(1!==this.state.pageInView){this.setState({drawerSlide:!0});var e=[];e.forEach.call(document.querySelectorAll("li.in-window"),function(e,t){e.classList.add("moving-out-to-right")}),e.forEach.call(document.querySelectorAll("li.left-of-window"),function(e,t){e.classList.add("moving-in-from-left")});var t=this,r=this.state.pageInView,n=r-1;setTimeout(function(){t.setState({pageInView:n})},650)}},updateStageState:function(e){PubSub.publish("newPrice",[0,0,0]),this.setState({stage:e,pageInView:1,drawerSlide:!1});var t=void 0;switch(e){case 0:t="materials",this.setState({_materials:o.WCmaterials,_collections:o.WCcollections,_swatches:{}});break;case 1:t="border";break;case 2:t="materials",0===o.WCborderMaterials.length?(this.setState({_materials:[],chosenMaterial:void 0,chosenCollection:void 0,chosenSwatch:void 0}),this.showBorderMaterials()):this.setState({_materials:o.WCborderMaterials});break;case 3:"Single & Piping"===this.state.chosenBorder?(t="swatches",this.setState({chosenMaterial:void 0,chosenCollection:void 0,chosenSwatch:void 0})):"Double Border"===this.state.chosenBorder&&(t="materials",this.setState({_materials:o.WCborderMaterials,chosenMaterial:void 0,chosenCollection:void 0,chosenSwatch:void 0}));break;case 4:t="size"}this.setState({open:!0,text:"Collapse"}),document.querySelector(".drawer__content__material").classList.remove("closed"),document.querySelector(".drawer__content__collections").classList.remove("closed"),document.querySelector(".drawer__content__swatches").classList.remove("closed"),document.querySelector(".drawer__content__swatches--selected").classList.remove("closed"),document.querySelector(".drawer__content__border").classList.remove("closed"),document.querySelector(".drawer__content__size").classList.remove("closed"),document.querySelector(".drawer__content__material").classList.add("open"),document.querySelector(".drawer__content__collections").classList.add("open"),document.querySelector(".drawer__content__swatches").classList.add("open"),document.querySelector(".drawer__content__swatches--selected").classList.add("open"),document.querySelector(".drawer__content__border").classList.add("open"),document.querySelector(".drawer__content__size").classList.add("open"),this.updateContentState(t)},showNewPrice:function(e){if(0===e)return void this.setState({price:!1});this.setState({price:e})},showBorderMaterials:function(){this.setState({_materials:o.WCborderMaterials})},updateContentState:function(e){"swatchesSelected"!==e?this.setState({content:e,pageInView:1}):this.setState({content:e})},updateMaterialChoice:function(e){var t=this;this.setState({chosenMaterial:e,chosenCollection:void 0,drawerSlide:!1}),2!==this.state.stage&&3!==this.state.stage||o.getCollectionsData(e).then(function(r){t.state._collections[e]=r,t.forceUpdate()}).catch(function(){o.error(101,"An error occured loading the requested collections",!0)})},updateCollectionChoice:function(e){var t=this;this.setState({chosenCollection:e,drawerSlide:!1}),o.loadingScreens("full","open"),o.getSwatchData(e).then(function(r){t.state._swatches[e]=r,o.loadingScreens("full","close"),t.forceUpdate()}).catch(function(){o.error(102,"An error occured loading the requested swatches",!0)})},updateSwatchChoice:function(e,t,r,n,a,i,s,c){this.setState({chosenSwatch:e,drawerSlide:!1}),o.loadingScreens("full","open");var l=this.state.stage;if(0===l)o.centerID=r;else switch(this.state.chosenBorder){case"Single Border":2===l&&(o.singleBorderID=r);break;case"Single & Piping":2===l?o.singleBorderID=r:3===l&&(o.pipingID=r);break;case"Double Border":2===l?o.innerBorderID=r:3===l&&(o.outerBorderID=r)}o.displayTexture(e,t,this.state.stage,n,a,i,s,c)},updateBorderChoice:function(e){this.setState({chosenBorder:e,drawerSlide:!1}),o.loadingScreens("full","open"),o.updateBorder(e)},handleSizeInputChange:function(e){return e.target.value<0||void 0===e.target.value?void this.setState({inputSizeErrorMessage:"Please enter a valid number"}):e.target.value>5&&"width"===e.target.name?void this.setState({inputSizeErrorMessage:"Maximum width is 5m"}):(this.setState({inputSizeErrorMessage:""}),void("length"===e.target.name?this.setState({length:e.target.value}):"width"===e.target.name&&this.setState({width:e.target.value})))},fireCalculatePrice:function(){o.calculatePrice(this.state.length,this.state.width)},createMaterialHTML:function(){return _createMaterialHTML(this,t,o)},createSidebarHTML:function(e){return _createSidebarHTML(this,a,e,o)},createCollectionsHTML:function(){return _createCollectionsHTML(this,r,o)},createSwatchesHTML:function(e){return _createSwatchesHTML(this,n,e,o)},createBorderHTML:function(){return _createBorderHTML(this,i,o)},createPipingHTML:function(){return _createPipingHTML(this,n,o)},createSizeHTML:function(){return _createSizeHTML(this,o)},createPriceHTML:function(){return _createPriceHTML(this,o)},render:function(){var t=this,r=t.createMaterialHTML(),n=function(e){return t.createSidebarHTML(e)},a=t.createCollectionsHTML(),i=function(e){return t.createSwatchesHTML(e)},s=t.createBorderHTML(),c=t.createSizeHTML(),l=t.createPriceHTML();window.abc=a;var d=t.state.open?"open":"closed",u="drawer__content__material open stage"+this.state.stage,p="";p+="drawer__content ",p+=d+" ",p+=this.state.content+" ",p+="Single & Piping"===t.state.chosenBorder&&3===t.state.stage&&"swatches"===t.state.content?"-piping":"",p+="Single & Piping"===t.state.chosenBorder&&3===t.state.stage&&"swatchesSelected"===t.state.content?"-piping-selected":"";var h="";if("collections"===this.state.content||"swatches"===this.state.content||"swatchesSelected"===this.state.content){this.state.pageInView,this.state.pageInView,o.numOfPages;h=React.createElement("div",{className:"scroll-btns clearfix"},React.createElement("div",{className:"scroll__left"},React.createElement("a",{href:"#",onClick:this.slideRight},React.createElement("img",{src:"https://d105txpzekqrfa.cloudfront.net/uploads/20170110134436/arrow-left.svg",alt:"Scroll Left"}))),React.createElement("div",{className:"scroll__right"},React.createElement("a",{href:"#",onClick:this.slideLeft},React.createElement("img",{src:"https://d105txpzekqrfa.cloudfront.net/uploads/20170110134433/arrow-right.svg",alt:"Scroll Right"}))))}var m=0,g=[];if("collections"===this.state.content){var w=t.state._collections,f=w[t.state.chosenMaterial];if(void 0!==f){window.innerWidth>768?Math.ceil(f.length/12):1}}else if("swatches"===this.state.content){var b=t.state._swatches,v=b[t.state.chosenCollection];if(void 0!==v){var _=window.innerWidth>992?18:9,S=Object.keys(v).length;m=Math.ceil(S/_)}}else if("swatchesSelected"===this.state.content){var y=(t.state.chosenSwatch.replace(/ /g,""),t.state._swatches[t.state.chosenCollection]);if(void 0!==y){var C=window.innerWidth>992?6:3,R=Object.keys(y).length;m=Math.ceil(R/C)}}for(var E=this.state.pageInView,M=0;M<m;M++){var B=M+1,k="dot";E===B&&(k+=" dot-active"),g.push(React.createElement("div",{className:k,"data-page":B}))}var x=React.createElement("div",{className:"dots clearfix"},g);return React.createElement("div",{className:"react-container drawer__container"},React.createElement("div",{className:p},React.createElement("div",{className:u},React.createElement("ul",null,r)),React.createElement("div",{className:"drawer__content__collections open clearfix"},React.createElement("div",{className:"drawer__collections__sidebar"},React.createElement("ul",null,n("collections"))),React.createElement("div",{className:"drawer__collections__collections"},React.createElement("ul",{className:"clearfix"},a))),React.createElement("div",{className:"drawer__content__swatches open clearfix"},React.createElement("div",{className:"drawer__swatches__sidebar"},React.createElement("ul",null,n("swatches"))),React.createElement("div",{className:"drawer__swatches__swatches"},React.createElement("ul",{className:"clearfix"},i("swatches")))),React.createElement("div",{className:"drawer__content__swatches--selected open clearfix"},React.createElement("div",{className:"drawer__swatches--selected__sidebar"},React.createElement("ul",null,n("swatches--selected"))),React.createElement("div",{className:"drawer__swatches--selected__swatches"},React.createElement("ul",{className:"clearfix"},i("swatches--selected")))),React.createElement("div",{className:"drawer__content__border open"},React.createElement("ul",null,s)),React.createElement("div",{className:"drawer__content__size open"},c,l),h,x),React.createElement(e,{currentlyOpen:this.state.open,text:this.state.text,open:this.open,close:this.close}))}});ReactDOM.render(React.createElement(s,null),document.querySelector("#drawer"))},RugBuilder.prototype.sideMenuComponent=function(){return React.createClass({displayName:"SideMenuComponent",handleClick:function(){this.props.onUpdate(this.props.material),this.props.updateContent&&this.props.updateContent("collections")},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:this.props.thumb,alt:this.props.material}),React.createElement("h3",null,this.props.material)))}})},RugBuilder.prototype.btnExitComponent=function(){return React.createClass({displayName:"BtnExitComponent",render:function(){var e=siteUrl+"/start-rugbuilder";return React.createElement("a",{href:e,className:"progress-menu__exit"},React.createElement("img",{src:"https://d105txpzekqrfa.cloudfront.net/uploads/20170110133952/exit.svg"}),"Exit")}})},RugBuilder.prototype.btnRestartComponent=function(){rugBuilder;return React.createClass({displayName:"BtnRestartComponent",restart:function(){location.reload()},render:function(){return React.createElement("a",{href:"#",className:"progress-menu__restart",onClick:this.restart},React.createElement("img",{src:"https://d105txpzekqrfa.cloudfront.net/uploads/20170110133914/restart.svg"}),"Start Again")}})},RugBuilder.prototype.btnStageComponent=function(){var e=rugBuilder;return React.createClass({displayName:"BtnStageComponent",handleClick:function(){var t=e.currentStage,r=this.props.index;return t===r?void e.updateStage(r):"single"===e.borderType&&2===t&&3===r?void e.updateStage(4):void(t+1===r?e.nextStage():t-1===r?e.prevStage():e.updateStage(r))},render:function(){var t=e.currentStage,r="";(this.props.index===t||"single"===e.borderType&&3===this.props.index&&4===t)&&(r="active");var n="progress-menu__stage "+r;return React.createElement("li",{className:n},React.createElement("a",{href:"#",className:"progress-menu__stage__link",onClick:this.handleClick},this.props.stage))}})},RugBuilder.prototype.menuComponent=function(e,t,r){var n=(rugBuilder,React.createClass({displayName:"MenuComponent",getInitialState:function(){return{stages:["Center","Border Type","Border","Rug Size"]}},componentDidMount:function(){this.stageChange=PubSub.subscribe("stageChange",this.stageHasChanged),this.borderChange=PubSub.subscribe("borderUpdate",this.borderHasChanged)},componentWillUnmount:function(){PubSub.unsubscribe(this.stageChange),PubSub.unsubscribe(this.borderChange)},stageHasChanged:function(){this.forceUpdate()},borderHasChanged:function(e){"single"===e?this.setState({stages:["Center","Border Type","Border","Rug Size"]}):"piping"===e?this.setState({stages:["Center","Border Type","Border","Piping","Rug Size"]}):"double"===e&&this.setState({stages:["Center","Border Type","Inner Border","Outer Border","Rug Size"]})},displayIsRetina:function(){if(window.devicePixelRatio>1)return!0;return!(!window.matchMedia||!window.matchMedia("(-webkit-min-device-pixel-ratio: 1.5),\t\t\t\t(min--moz-device-pixel-ratio: 1.5),\t\t\t\t(-o-min-device-pixel-ratio: 3/2),\t\t\t\t(min-resolution: 1.5dppx)").matches)},render:function(){var n=this.state.stages,a=n.map(function(e,t){return React.createElement(r,{stage:e,key:t,index:t})}),i=void 0;return i=this.displayIsRetina()?templateDirectoryUri+"/rugbuilder/assets/img/logo@2x.png":templateDirectoryUri+"/rugbuilder/assets/img/logo.png",React.createElement("div",{className:"progress-menu__container"},React.createElement("div",{className:"progress-menu__top"},React.createElement("img",{src:i,alt:"Crucial Trading Rug Builder",className:"logo"}),React.createElement(t,null),React.createElement(e,null)),React.createElement("div",{className:"progress-menu__bottom"},React.createElement("ul",{className:"progress-menu__stages"},a)))}}));ReactDOM.render(React.createElement(n,null),document.querySelector("#progress-menu"))};