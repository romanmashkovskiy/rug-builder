/**
 * about-timeline.js
 * 
 * jQuery for animating and creating the About page
 */

jQuery( document ).ready(function() {

var $ = jQuery;
	
	// Add classes for timeline
	$(function() {                     
	  $(".about__timeline__btn").click(function() { 
	    $(this).toggleClass("is-active");
	    $('body').toggleClass("show-about-timeline");    
	    
		    $(".is-active").click(function() {
				  $('body').toggleClass("hide-about-timeline");
			  });
	     
				var s = skrollr.init({
				render: function(data) {
					//Debugging - Log the current scroll position.
					console.log(data.curTop);
					}
				});
	     
	  });
	});
	
	// Add classes for scroller
	$(function() {                     
	  $(".about__scroller__btn").click(function() { 
	    $(this).toggleClass("is-active");
	    $('body').toggleClass("show-about-scroller");     
	    
	    $(".is-active").click(function() {
			  $('body').toggleClass("hide-about-scroller");
		  });
	    
	  });
	});
/*
 var s = skrollr.init({
      render: function(data) {
          //Debugging - Log the current scroll position.
          console.log(data.curTop);
      }
  });
*/
});
var $ = jQuery;

$(document).ready(function() {
	$('.close-basket-dropdown').on('click', function() {
		document.querySelector('.basket-dropdown').style.display = 'none';
	});
});
var $ = jQuery;

$(document).ready(function() {

	$('.order-brochure').on('click', function(e) {

		e.preventDefault();
		e.stopPropagation();

		var productName = $(this).data('product-name');
		var productID   = $(this).data('product-id');

		var url = '';

		var href = window.location.href;

		if ( href[href.length - 1] === '#' ) {
			href = window.location.href.substr(0, window.location.href.length - 1)
		}

		var url = href + 'product/brochure/?post_type=product&add-to-cart=' + productID;

		console.log(url)

		$.get(url)
			.done(function() {

				$('body').removeClass('basket-empty');
				$('body').addClass('basket-full');

				var oldNumItems = parseInt( $('#num-items-basket').text() );
				var newNumItems = oldNumItems + 1;

				$('#num-items-basket').text(newNumItems);
			})
			.fail(function() {
//				alert('fail');
			});

		return false;
	});
});

var $ = jQuery;

$(document).ready(function() {

	$('.contact-select select').change(function() {

		var value = $('.contact-select select').val();
		
		switch (value) {

			case 'general' :
				$('.contact-form #press').hide();
				$('.contact-form #trade').hide();
				$('.page-image img[data-tag="press"]').addClass('__hidden');
				$('.page-image img[data-tag="trade"]').addClass('__hidden');
				break;

			case 'press' :
				$('.contact-form #trade').hide();
				$('.contact-form #general').hide();
				$('.page-image img[data-tag="general"]').addClass('__hidden');
				$('.page-image img[data-tag="trade"]').addClass('__hidden');
				break;

			case 'trade' :
				$('.contact-form #press').hide();
				$('.contact-form #general').hide();
				$('.page-image img[data-tag="press"]').addClass('__hidden');
				$('.page-image img[data-tag="general"]').addClass('__hidden');
				break;
		}
		
		$('.contact-form #' + value).show();
		$('.page-image img[data-tag="' + value + '"]').removeClass('__hidden');
	});
});
var $ = jQuery;

$(document).ready(function() {

	if ( $('body').hasClass('page-template-retailer') ) {

		var $map = document.getElementById('google-map');

		var loc     = $($map).data('loc');
		var overseas = $($map).data('overseas');

		if ( loc !== '' ) {

			var geocoder = new google.maps.Geocoder();

			geocoder.geocode({ 
				'address'               : loc,
				'componentRestrictions' : {
					country: 'UK'
				}
			}, function(result, status) {

				var latLng = status === 'OK' ? { lat: result[0].geometry.location.lat(), lng: result[0].geometry.location.lng() } : { lat: 51.475, lng: -0.1875 };
				var zoom   = status === 'OK' ? 11 : 14;

				createMap( latLng, zoom, $map );
			});
		}
		else if ( overseas !== '' ) {

			var geocoder = new google.maps.Geocoder();

			geocoder.geocode({ 
				'address'               : overseas
			}, function(result, status) {

				var latLng = status === 'OK' ? { lat: result[0].geometry.location.lat(), lng: result[0].geometry.location.lng() } : { lat: 51.475, lng: -0.1875 };
				var zoom   = status === 'OK' ? 5 : 14;

				createMap( latLng, zoom, $map );
			});
		}
		else {

			var latLng = {
				lat: 51.475, 
				lng: -0.1875
			};

			createMap( latLng, 14, $map );
		}
	}
});

// http://localhost:8888/crucial-trading/wp-content/uploads/Combined-Shape-Copy.svg

function createMap( latLng, zoom, $map ) {

	var coordStr    = $($map).data('coordinates');
	var coordinates = coordStr && coordStr !== '' ? coordStr.split('|') : false;

	var overseas = $($map).data('overseas');

	var map = new google.maps.Map($map, {
		center           : latLng,
		zoom             : zoom,
		disableDefaultUI : true,
		zoomControl      : true,
		scrollwheel      : false
	});

	var styles = [
		{
			stylers: [
				{ hue        : '#64B253' },
				{ saturation : -80 }
			]
		}
	];

	map.setOptions({ styles: styles });

	var image = {
		scaledSize : new google.maps.Size(22, 30),
		origin : new google.maps.Point(0, 0),
		anchor : new google.maps.Point(11, 30),
		url    : 'http://d105txpzekqrfa.cloudfront.net/uploads/20161215113733/Combined-Shape-Copy.svg'
	}

	if ( coordinates ) {

		for ( var i = 0; i < coordinates.length; i++ ) {

			if ( coordinates[i] !== '' ) {

				var comma = coordinates[i].indexOf(',');

				var lat = parseFloat(coordinates[i].substring(0, comma));
				var lng = parseFloat(coordinates[i].substring(comma + 1, coordinates[i].length));

				var marker = new google.maps.Marker({
					position : { lat: lat, lng: lng },
					map      : map,
					icon     : image
				});
			}
		}
	}
	else if ( overseas && overseas !== '' ) {
		
		var marker = new google.maps.Marker({
			position : latLng,
			map      : map,
			icon     : image
		});
	}
}
/**
 * main-menu.js
 * 
 * jQuery for the main slide out menu 
 */

jQuery( document ).ready(function() {

var $ = jQuery;
	
	// Add classes - active tag to button and show menu to body	
	$(function() {                     
	  $(".main-menu__button").click(function(e) { 

	  	if ( !$(e.target).hasClass('link-opener') ) {
	  		$(this).toggleClass("is-active");
		    $('body').toggleClass("show-menu");
	  	} else {
	  		e.preventDefault();
	  		e.stopPropagation();
	  		document.querySelector('.basket-dropdown').style.display = 'block';
	  	}
	  });
	});
		
	// Remove classes and close menu when page is clicked 	
	$("html").click(function() {
		$('body').removeClass("show-menu");
		$('.main-menu__button').removeClass("is-active");
	});
	
	// Ignore above for menu and menu button 
	$('.main-menu, .main-menu__button').click(function(event){
	    event.stopPropagation();
	});
});
var $ = jQuery;

$(document).ready(function() {

	function closeInfoBox() {

		var boxWidth;

		if ( window.innerWidth > 992 ) {
			boxWidth = 400;
		} else if ( window.innerWidth > 768 && window.innerWidth < 993 ) {
			boxWidth = 325;
		} else {
			boxWidth = 200;
		}

		$('.material__details').animate({
			right: '-' + boxWidth + 'px'
		})

		$('.hide-material-info').text('Show')
		$('.hide-material-info').data('state', 'closed');
	}

	function openInfoBox() {

		var right;

		if ( window.innerWidth > 450 ) {
			right = '20px';
		} else {
			right = '0px';
		}

		$('.material__details').animate({
			right: right
		})

		$('.hide-material-info').text('Hide')
		$('.hide-material-info').data('state', 'open');
	}

	$('.hide-material-info').on('click', function(e) {

		e.preventDefault();
		e.stopPropagation();

		var state = $(this).data('state');

		if ( state === 'open' ) {
			closeInfoBox();
		}
		else if ( state === 'closed' ) {
			openInfoBox();
		}

		return false;
	});

	$('#change-image-view').on('click', function(e) {

		e.preventDefault();
		e.stopPropagation();

		var currentView = $(this).data('view');

		if ( currentView === 'top' ) {

			$(this).siblings('img').attr('src', $(this).data('angle'));

			$(this).parent().css('height', 'auto');

			$(this).siblings('img').css({
				height     : 'auto',
				marginLeft : '25%',
				width      : '50%'
			});

			$(this).data('view', 'angle');

		} else {

			$(this).siblings('img').attr('src', $(this).data('top'));

			$(this).parent().css('height', '450px');

			$(this).siblings('img').css({
				height     : '100%',
				marginLeft : '0',
				width      : '100%'
			});

			$(this).data('view', 'top');
		}

		return false;
	});

	$(document).on('click', '#add-swatch-to-basket', function(e) {

		e.preventDefault();
		e.stopPropagation();

		var productName = $(this).data('product-name');
		var productID   = $(this).data('product-id');
		var url         = window.location.href + '?post_type=product&add-to-cart=' + productID;

		$.get(url)
			.done(function() {
//				showBasketPopup(true, productName);
				$('body').removeClass('basket-empty');
				$('body').addClass('basket-full');
			})
			.fail(function() {
				showBasketPopup(false);
			})

		return false;
	});

//	$('.material-img').each(function(i, v) {
//		$(v).elevateZoom({
//			zoomType  : 'lens',
//			lensShape : 'round',
//			lensSize  : 200
//		});
//	});
});
$(document).ready(function() {

	var svgPrev = [
		'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="31px" height="59px" viewBox="0 0 31 59" version="1.1" class="prev-slide coir">',
		'<g id="Home" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="square" stroke="#7C7C7C">',
		'<g id="vivid" transform="translate(-45.000000, -553.000000)" stroke="#7C7C7C">',
		'<g id="slider-arrow" transform="translate(60.500000, 582.000000) rotate(-180.000000) translate(-60.500000, -582.000000) translate(46.000000, 553.000000)"  stroke="#7C7C7C">',
		'<path d="M0.201388889,0.201388889 L28.8071201,28.8071201" id="Line"/>',
		'<path d="M0,57.6057312 L28.6057312,29" id="Line"/>',
		'</g>',
		'</g>',
		'</g>',
		'</svg>'
	];

	var svgNext = [
		'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="31px" height="58px" viewBox="0 0 31 58" version="1.1" class="next-slide coir">',
		'<g id="Home" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="square" stroke="#7C7C7C">',
		'<g id="vivid" transform="translate(-1556.000000, -553.000000)" stroke="#7C7C7C">',
		'<g id="slider-arrow" transform="translate(1557.000000, 553.000000)"  stroke="#7C7C7C">',
		'<path d="M0.201388889,0.201388889 L28.8071201,28.8071201" id="Line"/>',
		'<path d="M0,57.6057312 L28.6057312,29" id="Line"/>',
		'</g>',
		'</g>',
		'</g>',
		'</svg>'
	];

	var startIndex;

	var spans = document.querySelectorAll('.material-view-slider ul li span');

	for ( var i = 0; i < spans.length; i++ ) {

		if ( spans[i].hasAttribute('data-show') ) {
			startIndex = spans[i].dataset.show;
			break;
		}
	}

	if ( $('.slidee').data('total') > 1 ) {

		$('.material-view-slider ul#material-view-slider-list').bxSlider({
			startSlide   : startIndex,

			nextSelector : '#material-view-slider-next',
			prevSelector : '#material-view-slider-prev',

			onSlideNext  : function() {

				var current = $('#material-view-slider-prev-text h3').data('current');
				var total   = $('#material-view-slider-prev-text h3').data('total');

				var newCurrent = current + 1;

				if ( newCurrent === total + 1 ) {
					newCurrent = 1;
				}

				var newNext = newCurrent + 1;
				var newPrev = newCurrent - 1;

				if ( newPrev === 0 ) {
					newPrev = total;
				}

				if ( newNext === total + 1 ) {
					newNext = 1;
				}

				$('#material-view-slider-prev-text h3').text(newPrev + '/' + total);
				$('#material-view-slider-next-text h3').text(newNext + '/' + total);

				$('#material-view-slider-prev-text h3').data('current', newCurrent);

	//			var newSlideIndex = this.getCurrentSlide();
	//			var newSlide      = $('#material-view-slider-list').children()[ newSlideIndex+1 ];
	//			var newProduct    = $(newSlide).data('name');

	//			window.location.hash = encodeURIComponent(newProduct);
			},

			onSlidePrev  : function() {

				var current = $('#material-view-slider-prev-text h3').data('current');
				var total   = $('#material-view-slider-prev-text h3').data('total');

				var newCurrent = current - 1;

				if ( newCurrent === 0 ) {
					newCurrent = total;
				}

				var newNext = newCurrent + 1;
				var newPrev = newCurrent - 1;

				if ( newPrev === 0 ) {
					newPrev = total;
				}

				if ( newNext === total + 1 ) {
					newNext = 1;
				}

				$('#material-view-slider-prev-text h3').text(newPrev + '/' + total);
				$('#material-view-slider-next-text h3').text(newNext + '/' + total);

				$('#material-view-slider-prev-text h3').data('current', newCurrent);

	//			var newSlideIndex = this.getCurrentSlide();
	//			var newSlide      = $('#material-view-slider-list').children()[ newSlideIndex+1 ];
	//			var newProduct    = $(newSlide).data('name');

	//			window.location.hash = encodeURIComponent(newProduct);
			},
		});
	}
		

	$('.bx-prev').addClass('no-effect');
	$('.bx-next').addClass('no-effect');

	$('.bx-prev').html(svgPrev.join(''));
	$('.bx-next').html(svgNext.join(''));
})
var $ = jQuery;

$(document).ready(function() {

	var slider = $('.materials-slider').bxSlider({
		mode: 'fade'
	});

	$('.next-slide.--material-slider').on('click', function() {
		slider.goToNextSlide();

		var curActive;

		$('.slide__list li').each(function(i, v) {

			if ( $(v).children('img').hasClass('active') ) {
				curActive = $(v).data('slide');
				$(v).children('img').removeClass('active');
			}
		});

		var newActive = curActive + 1;

		if ( curActive === 5 ) {
			newActive = 0;
		}

		$('.slide__list li[data-slide="' + newActive + '"] img').addClass('active');

		var oldSlide    = $('.materials-slider li.material-slide')[curActive];
		var oldMaterial = $(oldSlide).data('material');
		var newSlide    = $('.materials-slider li.material-slide')[newActive];
		var newMaterial = $(newSlide).data('material');

		$(this).removeClass(oldMaterial);
		$('.prev-slide').removeClass(oldMaterial);
		$(this).addClass(newMaterial);
		$('.prev-slide').addClass(newMaterial);
	});

	$('.prev-slide.--material-slider').on('click', function() {
		slider.goToPrevSlide();

		var curActive;

		$('.slide__list li').each(function(i, v) {

			if ( $(v).children('img').hasClass('active') ) {
				curActive = $(v).data('slide');
				$(v).children('img').removeClass('active');
			}
		});

		var newActive = curActive - 1;

		if ( curActive === 0 ) {
			newActive = 5;
		}

		$('.slide__list li[data-slide="' + newActive + '"] img').addClass('active');

		var oldSlide    = $('.materials-slider li.material-slide')[curActive];
		var oldMaterial = $(oldSlide).data('material');
		var newSlide    = $('.materials-slider li.material-slide')[newActive];
		var newMaterial = $(newSlide).data('material');

		$(this).removeClass(oldMaterial);
		$('.next-slide').removeClass(oldMaterial);
		$(this).addClass(newMaterial);
		$('.next-slide').addClass(newMaterial);
	});

	$('.slide__list li').on('click', function() {
		var newActive = $(this).data('slide');

		slider.goToSlide(newActive);

		$(this).siblings().each(function(i, v) {

			var curActive;

			if ( $(v).children('img').hasClass('active') ) {
				curActive = $(v).data('slide');
			}

			$('li[data-slide="' + curActive + '"] img').removeClass('active');
		})

		$('li[data-slide="' + newActive + '"] img').addClass('active');
	});

	$('.material-slide .slide__content').css('cssText', 'height: calc(100% - 60px)');

	setTimeout(function() {
		$('.material-slide').each(function(i, v) {
			$(v).css({
				top: 0,
				bottom: 0
			});
		});
	}, 500)
});

var $ = jQuery;

$(document).ready(function() {

	$('.retailer-search button').on('click', function() {

		if ( $('.overseas-partners').length === 1 ) {
			
			var postCode = $('.retailer-search input').val();

			if ( postCode === '' ) {
				alert('Please enter a post code');
				return;
			}

			var geocoder = new google.maps.Geocoder();

			geocoder.geocode({ 
				'address'               : postCode,
				'componentRestrictions' : {
					country: 'UK'
				}
			}, function(result, status) {

				if ( status !== 'OK' ) {
					alert('No');
					return;
				}

				var lat = result[0].geometry.location.lat();
				var lng = result[0].geometry.location.lng();

				$.ajax({
					type : 'GET',
					url  : window.location.origin + window.location.pathname + '?get_retailers=retailer'
				})
				.done(function(result) {
					
					var retailers        = JSON.parse(result);
					var retailersInRange = [];
					
					for ( var i = 0; i < retailers.length; i++ ) {

						var retailer = retailers[i];

						var rLat = retailer.lat;
						var rLng = retailer.lng;

						var distance = distanceBetweenPoints(lat, lng, rLat, rLng);

						if ( distance < 10 ) {

							var distanceRounded = Math.round( distance * 10 ) / 10;
							retailersInRange.push([retailer.ID, distanceRounded.toFixed(0)]);
						}
					}
					
					var urlBase = window.location.origin + window.location.pathname + '?results=';

					var results = '';

					for ( var i2 = 0; i2 < retailersInRange.length; i2++ ) {
						results += retailersInRange[i2][0] + '-' +   retailersInRange[i2][1] + ',';
					}

					var resultsEnc = window.btoa(results);

					var newUrl = urlBase + resultsEnc;

					newUrl += '&loc=' + encodeURIComponent(postCode);

					window.location.href = newUrl;
				})
				.fail(function(a, b, c) {
					console.log(a)
					console.log(b)
					console.log(c)
				})
			});

		}
		else if ( $('.uk-retailers').length === 1 ) {
			
			var country = $('.retailer-search select').val();

			$.ajax({
				type : 'GET',
				url  : window.location.origin + window.location.pathname + '?get_retailers=overseas'
			})
			.done(function(result) {

				var retailers = JSON.parse(result);
				var retailer;

				for ( var i = 0; i < retailers.length; i++ ) {

					if ( retailers[i].country === country ) {
						retailer = retailers[i];
						break;
					}
				}

				var newUrl = window.location.origin + window.location.pathname + '?country=' + country + '&id=' + retailer.ID;

				window.location.href = newUrl;
			})
			.fail(function(a, b, c) {
				console.log(a)
				console.log(b)
				console.log(c)
			})
		}			
	});

	var $overseasPartners = document.querySelector('.overseas-partners');

	if ( $overseasPartners ) {
		$overseasPartners.addEventListener('click', overseasPartners);
	}

	function overseasPartners() {

		$('.retailer-search input').hide();
		$('.retailer-search select').show();

		$(this).text('UK Retailers');
		$(this).removeClass('overseas-partners');
		$(this).addClass('uk-retailers');

		var $ukRetailers = document.querySelector('.uk-retailers');

		if ( $ukRetailers ) {
			$ukRetailers.removeEventListener('click', overseasPartners);
			$ukRetailers.addEventListener('click', ukRetailers);
		}
	}

	function ukRetailers() {

		$('.retailer-search select').hide();
		$('.retailer-search input').show();

		$(this).text('Overseas Partners');
		$(this).removeClass('uk-retailers');
		$(this).addClass('overseas-partners');

		var $overseasPartners = document.querySelector('.overseas-partners');

		if ( $overseasPartners ) {
			$overseasPartners.removeEventListener('click', ukRetailers);
			$overseasPartners.addEventListener('click', overseasPartners);
		}
	}
});

function distanceBetweenPoints(lat1, lon1, lat2, lon2) {

	var R    = 6371;
	var dLat = deg2rad(lat2-lat1);
	var dLon = deg2rad(lon2-lon1); 
	var a    = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
	var c    = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
	var d    = R * c;

	var miles = d * 0.621371;

	return miles;
}

function deg2rad(deg) {
	return deg * (Math.PI/180)
}
$ = jQuery;

$(document).ready(function() {

	var slider = $('#super-slider').superslides({
	//	play: 5000,
		animation: 'fade',
		animation_speed: 1200
	});

	$('.slide__numbers li').on('click', function() {

		var thisText = $(this).text();
		var index = parseInt(thisText.replace('0', '').replace('.', '')) - 1;

		$('#super-slider').superslides('animate', index)
	});

	$('.slide__arrow--down').on('click', function() {

		var windowHeight = $(window).height();
		var scrollTop    = windowHeight - 50;

		$('body').animate({
			scrollTop: scrollTop
		}, 1100);
	});

	/*$('#play-video').on('click', function(e) {

		e.preventDefault();
		e.stopPropagation();



		return false;
	});*/
});
// Add to Basket Confirmation Message

function showBasketPopup(success, productName) {

	$('.basketMessage').html('');

	if ( success ) {
		$('.basketMessage').html(productName + ' has been added to your <a href="' + siteURL + '/basket">basket</a>.');
	} else {
		$('.basketMessage').html('Sorry, an error has occured and ' + productName + ' could not be added to your basket. Please try again.');
	}

	$('.basketPopup').show();
}

$(document).ready(function() {

	// Login Form Placeholders

	$('#user_login').attr('placeholder', 'Username or Email');
	$('#user_pass').attr('placeholder', 'Password');

	// Inspiration Page Extra Content

	if ( $('body').hasClass('page-template-inspiration') || $('body').hasClass('page-template-home') ) {

		$('.fts-twitter-link-image').each(function(i, e) {
			$(e).append('<i class="icon-crucial-twitter"></i>');
		});

		$('.fts-instagram-wrapper').each(function(i, e) {
			$(e).append('<i class="icon-crucial-instagram"></i>');
		});

		$('.fts-twitter-text').each(function(i, e) {
			$(e).append('<div class="twitter-shadow"></div>');
		});
	}

	// Close Add to Basket Confirmation Message

	$(document).on('click', '#close-basket-popup', function(e) {

		e.preventDefault();
		e.stopPropagation();

		$('.basketPopup').hide();

		return false;
	});
});
//# sourceMappingURL=maps/master.min.js.map
