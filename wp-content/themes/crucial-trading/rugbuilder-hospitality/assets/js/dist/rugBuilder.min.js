"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _loadMaps(e,t){void 0!==t&&("object"===_typeof(t.nmap)&&Object.keys(t.nmap).forEach(function(r){var a=t.nmap[r].full_url;(new THREE.TextureLoader).load(a,function(t){e.normalMap=t,e.needsUpdate=!0})}),"object"===_typeof(t.bmap)&&Object.keys(t.bmap).forEach(function(r){var a=t.bmap[r].full_url;(new THREE.TextureLoader).load(a,function(t){e.bumpMap=t,e.needsUpdate=!0})}),"object"===_typeof(t.dmap)&&Object.keys(t.dmap).forEach(function(r){var a=t.dmap[r].full_url;(new THREE.TextureLoader).load(a,function(t){e.displacementMap=t,e.needsUpdate=!0})}))}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),RugBuilder=function(){function e(t){_classCallCheck(this,e),this.context=t,this.imageContainer=document.querySelector("#img-container"),this.structureCodes=["H3150","H4350"],this.structureColorCodes={H1150:["A1000","A4000","C4001","F7000"],H1200:["A1000","A4000","C4001","F7000"],H2050:["A1000","A4000","C4001","F7000"],H2060:["A1000","A4000","C4001","F7000"],H2070:["A1000","A4000","C4001","F7000"],H2100:["A1000","A4000","C4001","F7000"],H2150:["A1000","A4000","C4001","F7000"],H2250:["A1000","A4000","C4001","F7000"],H2360:["A1000","A4000","C4001","F7000"],H2510:["A1000","A4000","C4001","F7000"],H3150:["H70000","H70001","H70002","H70003","J4000","J7000"],H3750:["A1000","A4000","C4001","F7000"],H4350:["A1000","A4000","C4001","F7000"]},this.numStructureColors={H1150:1,H1200:1,H2050:1,H2060:1,H2070:1,H2100:1,H2150:1,H2250:1,H2360:1,H2510:1,H3750:1,H3150:2,H4350:6},this.structureImages={},this.colorStage=0,this.stageVisited=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1]}return _createClass(e,[{key:"startAgain",value:function(){this.colorStage=0,this.stageVisited=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1],PubSub.publish("stageChange",0)}}]),e}();RugBuilder.prototype.start=function(){function e(){var e=t.btnExitComponent(),r=t.btnRestartComponent(),a=t.btnStageComponent();t.menuComponent(e,r,a);var n=t.btnExpandCollapseComponent(),o=t.btnStructureComponent(),s=t.btnColorComponent();t.drawerComponent(n,o,s)}var t=rugBuilder;t.getStructuresData().then(function(){e()})},RugBuilder.prototype.getStructuresData=function(){return new Promise(function(e,t){for(var r=rugBuilder,a=function(e){function t(){var e=new Uint8Array(this.response),t=new Blob([e],{type:"image/png"}),n=window.URL||window.webkitURL,o=n.createObjectURL(t);r.structureImages[a]=o}var a=r.structureCodes[e],n=templateDirectoryUri+"/rugbuilder-hospitality/assets/img/rugs/"+a+"/base.png";r.ajax("GET",n,t,"arraybuffer")},n=0;n<r.structureCodes.length;n++)a(n);var o=0;setInterval(function(){100===o&&t();var a=r.structureCodes.length,n=0,s=void 0;for(s in r.structureImages)r.structureImages.hasOwnProperty(s)&&n++;return a===n?void e():void o++},100)})},RugBuilder.prototype.ajax=function(e,t,r,a){var n=new XMLHttpRequest;void 0!==a&&(n.responseType=a),n.addEventListener("load",r),n.open(e,t),n.send()},RugBuilder.prototype.displayTexture=function(e,t,r,a){if(t.indexOf("-150x150")>-1&&(t=t.replace("-150x150","")),1!==r&&4!==r){var n=rugBuilder,o=n.borderType,s=void 0,i=void 0,c=void 0,l=void 0;switch(r){case 0:s="centerMaterial",l=["center"];break;case 2:"single"===o?(s="borderMaterials",i="single",l=["border-east","border-north","border-south","border-west"]):"piping"===o?(s="borderMaterials",i="piping",l=["border-east","border-north","border-south","border-west","trim-east","trim-north","trim-south","trim-west"]):(s="borderMaterials",i="double",c="inner",l=["border-inner-east","border-inner-north","border-inner-south","border-inner-west"]);break;case 3:s="borderMaterials",i="double",c="outer",l=["border-outer-east","border-outer-north","border-outer-south","border-outer-west"]}if(void 0===n.loadedTextures[e])(new THREE.TextureLoader).load(t,function(t){t.wrapS=t.wrapT=THREE.RepeatWrapping,t.anisotropy=n.renderer.getMaxAnisotropy(),0===r?t.repeat.set(2,2):2!==r&&3!==r||t.repeat.set(10,10);var o=new THREE.MeshPhongMaterial({map:t,color:16777215,shininess:5});n.loadedTextures[e]=o,void 0!==c?n[s][i][c]=e:void 0!==i?n[s][i]=e:n[s]=e;for(var u=0;u<n.scene.children.length;u++)l.indexOf(n.scene.children[u].name)>-1&&(n.scene.children[u].material=n.loadedTextures[e],_loadMaps(n.scene.children[u].material,a))});else{void 0!==c?n[s][i][c]=e:void 0!==i?n[s][i]=e:n[s]=e;for(var u=0;u<n.scene.children.length;u++)l.indexOf(n.scene.children[u].name)>-1&&(n.scene.children[u].material=n.loadedTextures[e],_loadMaps(n.scene.children[u].material,a))}}},RugBuilder.prototype.error=function(e,t){var r=document.querySelector("#error-box"),a=document.querySelector("#error-msg");a.innerText="";var n=void 0;switch(t){case 1:n="";break;case 1:n="";break;case 1:n="";break;case 1:n="";break;default:n="Sorry, an error has occured. Please try again."}a.innerHTML=n,e?r.style.display="block":r.style.display="none"},RugBuilder.prototype.loadingScreens=function(e,t){var r=void 0;switch(e){case"full":r="#full-loading";break;case"drawer":r="#drawer-loading";break;case"canvas":r="#canvas-loading"}var a="open"===t?99999:-99999;document.querySelector(r).style.zIndex=a},RugBuilder.prototype.imageComponent=function(e,t){var r=rugBuilder,a=React.createClass({displayName:"ImageComponent",render:function(){return React.createElement("img",{src:t,alt:e})}}),n="#color-"+r.colorStage;ReactDOM.render(React.createElement(a,null),document.querySelector(n))},RugBuilder.prototype.orderScreenComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"OrderScreenComponent",getInitialState:function(){this.centerID=0,this.singleBorderID=0,this.innerBorderID=0,this.outerBorderID=0;var t=e.centerMaterial,r=e.centerID,a=e.borderType,n=("single"===a||"piping"===a)&&e.borderMaterials[a],o=("single"===a||"piping"===a)&&e.singleBorderID,s="double"===a&&e.borderMaterials.double.inner,i="double"===a&&e.borderMaterials.double.outer,c="double"===a&&e.innerBorderID,l="double"===a&&e.outerBorderID,u=e.length,d=e.width,p=e.price,m=e.camera.position,h=e.camera.rotation,g={centerMaterial:t,centerID:r,borderType:a,singleBorderMaterial:n,innerBorderMaterial:s,outerBorderMaterial:i,singleBorderID:o,innerBorderID:c,outerBorderID:l,length:u,width:d,price:p,cameraPosition:m,cameraRotation:h};return g},edit:function(){e.camera.position.x=this.state.cameraPosition.x,e.camera.position.y=this.state.cameraPosition.y,e.camera.position.z=this.state.cameraPosition.z,e.camera.rotation.x=this.state.cameraRotation.x,e.camera.rotation.y=this.state.cameraRotation.y,e.camera.rotation.z=this.state.cameraRotation.z,e.updateStage(4),ReactDOM.unmountComponentAtNode(document.querySelector("#order-screen"))},print:function(){window.print()},order:function(){function e(){return 200!==this.status?void alert("error"):void alert("samples added to your basket")}var t=this.state.borderType,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1)),r+="?products=",r+=this.state.centerID+",","single"===t||"piping"===t?r+=this.state.singleBorderID:"double"===t&&(r+=this.state.innerBorderID+",",r+=this.state.outerBorderID);var a=new XMLHttpRequest;a.addEventListener("load",e),a.open("GET",r),a.send()},basket:function(){function e(){return 200!==this.status?void alert("error"):void alert("rug added to your basket")}var t=this.state.borderType,r=window.location.href;"#"===r[r.length-1]&&(r=r.substr(0,r.length-1)),r+="?products=",r+=this.state.centerID+",","single"===t||"piping"===t?r+=this.state.singleBorderID:"double"===t&&(r+=this.state.innerBorderID+",",r+=this.state.outerBorderID),r+="&center="+this.state.centerID,r+="&length="+this.state.length,r+="&width="+this.state.width,r+="&price="+this.state.price;var a=new XMLHttpRequest;a.addEventListener("load",e),a.open("GET",r),a.send()},render:function(){var t={};t.Center=this.state.centerMaterial,"single"===this.state.borderType||"piping"===this.state.borderType?t.Border=this.state.singleBorderMaterial:"double"===this.state.borderType&&(t["Inner Border"]=this.state.innerBorderMaterial,t["Outer Border"]=this.state.outerBorderMaterial);var r=function(){return Object.keys(t).map(function(e,r){return React.createElement("div",{className:"details__row clearfix",key:r},React.createElement("p",null,t[e]),React.createElement("p",null,e))})},a=document.querySelector("canvas").toDataURL();return e.loadingScreens("full","close"),React.createElement("div",{className:"order"},React.createElement("h2",{className:"order__title"},"Order Rug"),React.createElement("span",{className:"order__underline"}),React.createElement("div",{className:"order__content clearfix"},React.createElement("div",{className:"order__image"},React.createElement("img",{src:a,alt:"Your Rug"})),React.createElement("div",{className:"order__details"},React.createElement("div",{className:"details__row header clearfix"},React.createElement("h3",null,"Material"),React.createElement("h3",null,"Section")),r(),React.createElement("div",{className:"details__row header sizing clearfix"},React.createElement("h3",null,"Sizing"),React.createElement("h3",null,"Price")),React.createElement("div",{className:"details__row clearfix"},React.createElement("p",null,this.state.length,"m x ",this.state.width,"m"),React.createElement("p",null,"£",this.state.price)))),React.createElement("div",{className:"order__links"},React.createElement("a",{href:"#",className:"link__edit",onClick:this.edit},"Edit Rug"),React.createElement("a",{href:"#",className:"link__print",onClick:this.print},"Print Details"),React.createElement("a",{href:"#",className:"link__order",onClick:this.order},"Order Samples"),React.createElement("a",{href:"#",className:"link__basket",onClick:this.basket},"Add to Basket")))}});ReactDOM.render(React.createElement(t,null),document.querySelector("#order-screen"))},RugBuilder.prototype.priceComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"PriceComponent",getInitialState:function(){return{price:0}},componentDidMount:function(){this.newPrice=PubSub.subscribe("newPrice",this.showNewPrice)},componentWillUnmount:function(){PubSub.unsubscribe(this.newPrice)},showNewPrice:function(e){return 0===e?void this.setState({price:!1}):void this.setState({price:e})},goToOrderScreen:function(){e.camera.position.y=120,e.camera.position.z=0,setTimeout(function(){e.orderScreenComponent()},10)},render:function(){var e=void 0;return e=this.state.price?React.createElement("span",null,React.createElement("h3",null,"£ ",this.state.price),React.createElement("a",{href:"#",onClick:this.goToOrderScreen},"Finish Building")):"",React.createElement("div",{className:"price__container"},e)}});ReactDOM.render(React.createElement(t,null),document.querySelector("#price"))},RugBuilder.prototype.btnColorComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"BtnColorComponent",handleClick:function(){var t=templateDirectoryUri+"/rugbuilder-hospitality/assets/img/rugs/"+this.props.structure+"/"+this.props.color+"/colour-"+e.colorStage+".png";e.imageComponent(this.props.color,t),this.props.onClick(this.props.color)},render:function(){var e=templateDirectoryUri+"/rugbuilder-hospitality/assets/img/flat-colors/"+this.props.color+".jpg";return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("img",{src:e,alt:this.props.color})))}});return t},RugBuilder.prototype.btnExpandCollapseComponent=function(){var e=React.createClass({displayName:"BtnExpandCollapseComponent",handleClick:function(){this.props.currentState.open?this.props.onUpdate(!0):this.props.onUpdate(!1)},render:function(){return React.createElement("a",{href:"#",className:"expCol",onClick:this.handleClick},this.props.currentState.text)}});return e},RugBuilder.prototype.btnStructureComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"BtnStructureComponent",handleClick:function(){e.imageComponent(this.props.code,this.props.img),this.props.onClick(this.props.code)},render:function(){return React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.handleClick},React.createElement("h3",null,this.props.code),React.createElement("img",{src:this.props.img,alt:this.props.code})))}});return t},RugBuilder.prototype.drawerComponent=function(e,t,r){var a=rugBuilder,n=React.createClass({displayName:"DrawerComponent",getInitialState:function(){var e=a.structureImages;return{stage:"structures",open:!0,text:"Collapse",chosenStructure:void 0,chosenColors:[],_structures:e,_colors:void 0}},componentDidMount:function(){this.stageChange=PubSub.subscribe("newStage",this.stageHasChanged)},componentWillUnmount:function(){PubSub.unsubscribe(this.stageChange)},updateOpenState:function(e){var t=document.querySelector("#drawer");if(e){var r=t.offsetHeight;t.style.marginTop="-"+r+"px",this.setState({open:!1,text:"Expand"})}else t.style.marginTop=0,this.setState({open:!0,text:"Collapse"})},stageHasChanged:function(e){this.updateDrawer(e)},updateDrawer:function(e){var t=void 0;switch(e){case 0:t="structures";break;default:t="colors"}this.setState({stage:t})},updateStructure:function(e){for(var t=1;t<10;t++)ReactDOM.unmountComponentAtNode(document.querySelector("#color-"+t));a.stageVisited=[!0,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.setState({_colors:a.structureColorCodes[e],chosenStructure:e,chosenColors:[]}),PubSub.publish("newStructure",e)},updateColor:function(e){this.state.chosenColors[a.colorStage-1]=e},render:function(){var a=this,n=void 0,o=void 0;"structures"===this.state.stage&&(n=Object.keys(this.state._structures).map(function(e,r){var n=a.state._structures[e];return React.createElement(t,{key:r,code:e,img:n,onClick:a.updateStructure})})),"colors"===this.state.stage&&(o=this.state._colors.map(function(e,t){return React.createElement(r,{key:t,color:e,structure:a.state.chosenStructure,onClick:a.updateColor})}));var s=this.state.open?"open":"closed",i="drawer__content "+s+" "+this.state.stage;return React.createElement("div",{className:"react-container drawer__container"},React.createElement("div",{className:i},React.createElement("div",{className:"drawer__content"},React.createElement("ul",{className:"clearfix structures"},n),React.createElement("ul",{className:"clearfix colors"},o))),React.createElement(e,{onUpdate:this.updateOpenState,currentState:this.state}))}});ReactDOM.render(React.createElement(n,null),document.querySelector("#drawer"))},RugBuilder.prototype.btnExitComponent=function(){var e=React.createClass({displayName:"BtnExitComponent",render:function(){var e=templateDirectoryUri+"/rugbuilder/assets/icons/exit.svg",t=window.location.href;return React.createElement("a",{href:t,className:"progress-menu__exit"},React.createElement("img",{src:e}),"Exit")}});return e},RugBuilder.prototype.btnRestartComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"BtnRestartComponent",restart:function(){e.updateStage(0),e.startAgain(),e.updateBorder("Single & Piping")},render:function(){var e=templateDirectoryUri+"/rugbuilder/assets/icons/restart.svg";return React.createElement("a",{href:"#",className:"progress-menu__restart",onClick:this.restart},React.createElement("img",{src:e}),"Start Again")}});return t},RugBuilder.prototype.btnStageComponent=function(){var e=rugBuilder,t=React.createClass({displayName:"BtnStageComponent",handleClick:function(){var t=e.colorStage,r=this.props.index;if(t!==r){if(t+1===r)e.colorStage=e.colorStage+1;else if(t-1===r)e.colorStage=e.colorStage-1;else{var a=!1;if(e.stageVisited[r]?a=!0:e.stageVisited[r-1]&&(a=!0),!a)return;e.colorStage=r}e.stageVisited[r]=!0,PubSub.publish("newStage",r)}},render:function(){var t=e.colorStage,r="";this.props.index===t&&(r="active");var a="progress-menu__stage "+r;return React.createElement("li",{className:a},React.createElement("a",{href:"#",className:"progress-menu__stage__link",onClick:this.handleClick},this.props.stage))}});return t},RugBuilder.prototype.menuComponent=function(e,t,r){var a=rugBuilder,n=React.createClass({displayName:"MenuComponent",getInitialState:function(){return{stages:["Structure"]}},componentDidMount:function(){this.structureChange=PubSub.subscribe("newStructure",this.structureHasChanged),this.stageChange=PubSub.subscribe("newStage",this.stageHasChanged)},componentWillUnmount:function(){PubSub.unsubscribe(this.structureChange),PubSub.unsubscribe(this.stageChange)},structureHasChanged:function(e){for(var t=a.numStructureColors[e],r=["Structure"],n=0;n<t;n++){var o=n+1;r.push("Colour "+o)}this.setState({stages:r})},stageHasChanged:function(e){this.forceUpdate()},render:function(){var a=this.state.stages,n=a.map(function(e,t){return React.createElement(r,{stage:e,key:t,index:t})}),o=templateDirectoryUri+"/rugbuilder/assets/img/logo.png";return React.createElement("div",{className:"progress-menu__container"},React.createElement("div",{className:"progress-menu__top"},React.createElement("img",{src:o,alt:"Crucial Trading Rug Builder"}),React.createElement(t,null),React.createElement(e,null)),React.createElement("div",{className:"progress-menu__bottom"},React.createElement("ul",{className:"progress-menu__stages"},n)))}});ReactDOM.render(React.createElement(n,null),document.querySelector("#progress-menu"))};
//# sourceMappingURL=maps/rugBuilder.min.js.map
